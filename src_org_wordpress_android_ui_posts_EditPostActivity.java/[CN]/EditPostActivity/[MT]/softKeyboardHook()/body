{
  final View scrollView=findViewById(R.id.scrollView);
  scrollView.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener(){
    @Override public void onGlobalLayout(){
      Rect r=new Rect();
      scrollView.getWindowVisibleDisplayFrame(r);
      int heightDiff=scrollView.getRootView().getHeight() - (r.bottom - r.top);
      if (heightDiff > 100) {
        mKeyboardShown=true;
        showFormatBar();
      }
 else {
        mKeyboardShown=false;
        hideFormatBar();
      }
    }
  }
);
}
