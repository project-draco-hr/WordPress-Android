{
  LayoutRecord rec=mLayoutRecords.get(position);
  if (rec == null) {
    rec=new LayoutRecord();
    rec.span=span;
    mLayoutRecords.put(position,rec);
  }
 else   if (rec.span != span) {
    throw new IllegalStateException("Invalid LayoutRecord! Record had span=" + rec.span + " but caller requested span="+ span+ " for position="+ position);
  }
  int targetCol=-1;
  int topMost=Integer.MAX_VALUE;
  final int colCount=mColCount;
  for (int i=0; i <= colCount - span; i++) {
    int bottom=Integer.MIN_VALUE;
    for (int j=i; j < i + span; j++) {
      final int singleBottom=mItemBottoms[j];
      if (singleBottom > bottom) {
        bottom=singleBottom;
      }
    }
    if (bottom < topMost) {
      topMost=bottom;
      targetCol=i;
    }
  }
  rec.column=targetCol;
  for (int i=0; i < span; i++) {
    rec.setMarginAbove(i,topMost - mItemBottoms[i + targetCol]);
  }
  return rec;
}
