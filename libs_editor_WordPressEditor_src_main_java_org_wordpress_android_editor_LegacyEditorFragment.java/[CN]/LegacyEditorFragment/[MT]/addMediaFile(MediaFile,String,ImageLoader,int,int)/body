{
  mediaFile.setFileURL(imageUrl);
  mediaFile.setFilePath(imageUrl);
  final WPEditImageSpan imageSpan=createWPEditImageSpan(mActivity,mediaFile);
  mEditorFragmentListener.saveMediaFile(mediaFile);
  imageSpan.setMediaFile(mediaFile);
  Handler handler=new Handler(Looper.getMainLooper());
  final Runnable r=new Runnable(){
    @Override public void run(){
      int selectionStart=start;
      int selectionEnd=end;
      if (selectionStart > selectionEnd) {
        int temp=selectionEnd;
        selectionEnd=selectionStart;
        selectionStart=temp;
      }
      imageSpan.setPosition(selectionStart,selectionEnd);
      int line, column=0;
      if (mContentEditText.getLayout() != null) {
        line=mContentEditText.getLayout().getLineForOffset(selectionStart);
        column=selectionStart - mContentEditText.getLayout().getLineStart(line);
      }
      Editable s=mContentEditText.getText();
      if (s == null) {
        return;
      }
      WPImageSpan[] imageSpans=s.getSpans(selectionStart,selectionEnd,WPImageSpan.class);
      if (imageSpans.length != 0) {
        s.insert(selectionEnd,"\n\n");
        selectionStart=selectionStart + 2;
        selectionEnd=selectionEnd + 2;
      }
 else       if (column != 0) {
        s.insert(selectionEnd,"\n");
        selectionStart=selectionStart + 1;
        selectionEnd=selectionEnd + 1;
      }
      s.insert(selectionStart," ");
      s.setSpan(imageSpan,selectionStart,selectionEnd + 1,Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
      AlignmentSpan.Standard as=new AlignmentSpan.Standard(Layout.Alignment.ALIGN_CENTER);
      s.setSpan(as,selectionStart,selectionEnd + 1,Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
      s.insert(selectionEnd + 1,"\n\n");
      if (imageLoader != null && URLUtil.isNetworkUrl(imageUrl)) {
        loadWPImageSpanThumbnail(mediaFile,imageUrl,imageLoader);
      }
    }
  }
;
  handler.postDelayed(r,1);
}
