{
  if (mSimperium == null) {
    mSimperium=Simperium.newClient(BuildConfig.SIMPERIUM_APP_NAME,BuildConfig.SIMPERIUM_APP_SECRET,context);
    try {
      mNotesBucket=mSimperium.bucket(new Note.Schema());
      mMetaBucket=mSimperium.bucket("meta");
      mSimperium.setUserStatusChangeListener(new User.StatusChangeListener(){
        @Override public void onUserStatusChange(        User.Status status){
switch (status) {
case AUTHORIZED:
            mNotesBucket.start();
          mMetaBucket.start();
        break;
case NOT_AUTHORIZED:
      mNotesBucket.stop();
    mMetaBucket.stop();
  Intent simperiumNotAuthorizedIntent=new Intent();
simperiumNotAuthorizedIntent.setAction(BROADCAST_ACTION_SIMPERIUM_NOT_AUTHORIZED);
LocalBroadcastManager.getInstance(context).sendBroadcast(simperiumNotAuthorizedIntent);
break;
default :
AppLog.d(AppLog.T.SIMPERIUM,"User not authorized yet");
break;
}
}
}
);
}
 catch (BucketNameInvalid e) {
AppLog.e(AppLog.T.SIMPERIUM,e.getMessage());
}
}
authorizeUser(mSimperium,token);
return mSimperium;
}
