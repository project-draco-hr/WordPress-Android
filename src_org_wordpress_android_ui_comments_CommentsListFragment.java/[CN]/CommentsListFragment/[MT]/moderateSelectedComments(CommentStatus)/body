{
  final String newStatusStr=CommentStatus.toString(newStatus);
  final Blog blog=WordPress.currentBlog;
  final int numChecked=getCheckedCommentCount();
  final List<Comment> updatedComments=new LinkedList<Comment>();
  mModerateErrorMsg="";
  Iterator it=selectedCommentPositions.iterator();
  while (it.hasNext()) {
    int i=(Integer)it.next();
    XMLRPCClient client=new XMLRPCClient(blog.getUrl(),blog.getHttpuser(),blog.getHttppassword());
    Comment curComment=(Comment)getListView().getItemAtPosition(i);
    if (newStatusStr.equals(curComment.getStatus())) {
      it.remove();
      continue;
    }
    Map<String,String> postHash=new HashMap<String,String>();
    postHash.put("status",newStatusStr);
    postHash.put("content",StringUtils.notNullStr(curComment.comment));
    postHash.put("author",StringUtils.notNullStr(curComment.name));
    postHash.put("author_url",StringUtils.notNullStr(curComment.authorURL));
    postHash.put("author_email",StringUtils.notNullStr(curComment.authorEmail));
    Object[] params={blog.getRemoteBlogId(),blog.getUsername(),blog.getPassword(),curComment.commentID,postHash};
    Object result;
    try {
      result=client.call("wp.editComment",params);
      boolean bResult=Boolean.parseBoolean(result.toString());
      if (bResult) {
        it.remove();
        curComment.setStatus(newStatusStr);
        mComments.set(i,curComment);
        WordPress.wpDB.updateCommentStatus(WordPress.currentBlog.getLocalTableBlogId(),curComment.commentID,newStatusStr);
        updatedComments.add(curComment);
      }
    }
 catch (    XMLRPCException e) {
      mModerateErrorMsg=getResources().getText(R.string.error_moderate_comment).toString();
    }
  }
  dismissDialog(ID_DIALOG_MODERATING);
  if (hasActivity()) {
    Thread action=new Thread(){
      public void run(){
        hideModerationBar();
        if (TextUtils.isEmpty(mModerateErrorMsg)) {
          final String msg;
          if (numChecked > 1) {
            msg=getResources().getText(R.string.comments_moderated).toString();
          }
 else {
            msg=getResources().getText(R.string.comment_moderated).toString();
          }
          Toast.makeText(getActivity(),msg,Toast.LENGTH_SHORT).show();
          mOnCommentChangeListener.onCommentsModerated(updatedComments);
          ((WPActionBarActivity)getActivity()).updateMenuDrawer();
        }
 else         if (!getActivity().isFinishing()) {
          getListView().invalidateViews();
          FragmentTransaction ft=getFragmentManager().beginTransaction();
          WPAlertDialogFragment alert=WPAlertDialogFragment.newInstance(mModerateErrorMsg);
          ft.add(alert,"alert");
          ft.commitAllowingStateLoss();
        }
      }
    }
;
    getActivity().runOnUiThread(action);
  }
}
