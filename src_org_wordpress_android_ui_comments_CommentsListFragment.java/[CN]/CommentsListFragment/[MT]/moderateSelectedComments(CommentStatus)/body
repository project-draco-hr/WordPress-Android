{
  final String newStatusStr=CommentStatus.toString(newStatus);
  final Blog blog=WordPress.currentBlog;
  final int numChecked=getCheckedCommentCount();
  mModerateErrorMsg="";
  Iterator it=selectedCommentPositions.iterator();
  final List<Comment> updatedComments=new LinkedList<Comment>();
  while (it.hasNext()) {
    int i=(Integer)it.next();
    XMLRPCClient client=new XMLRPCClient(blog.getUrl(),blog.getHttpuser(),blog.getHttppassword());
    Comment listRow=(Comment)getListView().getItemAtPosition(i);
    int curCommentID=listRow.commentID;
    Map<String,String> contentHash, postHash=new HashMap<String,String>();
    contentHash=(Map<String,String>)mCommentHashes.get(curCommentID);
    if (contentHash.get("status").equals(newStatusStr)) {
      it.remove();
      continue;
    }
    postHash.put("status",newStatusStr);
    postHash.put("content",contentHash.get("comment"));
    postHash.put("author",contentHash.get("author"));
    postHash.put("author_url",contentHash.get("url"));
    postHash.put("author_email",contentHash.get("email"));
    Object[] params={blog.getRemoteBlogId(),blog.getUsername(),blog.getPassword(),curCommentID,postHash};
    Object result;
    try {
      result=client.call("wp.editComment",params);
      boolean bResult=Boolean.parseBoolean(result.toString());
      if (bResult) {
        it.remove();
        listRow.setStatus(newStatusStr);
        contentHash.put("status",newStatusStr);
        mComments.set(i,listRow);
        WordPress.wpDB.updateCommentStatus(WordPress.currentBlog.getLocalTableBlogId(),listRow.commentID,newStatusStr);
        updatedComments.add(WordPress.wpDB.getComment(WordPress.currentBlog.getLocalTableBlogId(),listRow.commentID));
      }
    }
 catch (    XMLRPCException e) {
      mModerateErrorMsg=getResources().getText(R.string.error_moderate_comment).toString();
    }
  }
  dismissDialog(ID_DIALOG_MODERATING);
  if (hasActivity()) {
    Thread action=new Thread(){
      public void run(){
        hideModerationBar();
        if (TextUtils.isEmpty(mModerateErrorMsg)) {
          final String msg;
          if (numChecked > 1) {
            msg=getResources().getText(R.string.comments_moderated).toString();
          }
 else {
            msg=getResources().getText(R.string.comment_moderated).toString();
          }
          Toast.makeText(getActivity(),msg,Toast.LENGTH_SHORT).show();
          mOnCommentChangeListener.onCommentsModerated(updatedComments);
          ((WPActionBarActivity)getActivity()).updateMenuDrawer();
        }
 else         if (!getActivity().isFinishing()) {
          getListView().invalidateViews();
          FragmentTransaction ft=getFragmentManager().beginTransaction();
          WPAlertDialogFragment alert=WPAlertDialogFragment.newInstance(mModerateErrorMsg);
          ft.add(alert,"alert");
          ft.commitAllowingStateLoss();
        }
      }
    }
;
    getActivity().runOnUiThread(action);
  }
}
