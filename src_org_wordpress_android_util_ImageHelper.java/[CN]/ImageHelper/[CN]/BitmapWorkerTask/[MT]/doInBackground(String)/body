{
  path=params[0];
  BitmapFactory.Options bfo=new BitmapFactory.Options();
  bfo.inJustDecodeBounds=true;
  BitmapFactory.decodeFile(path,bfo);
  bfo.inSampleSize=calculateInSampleSize(bfo,targetWidth,targetHeight);
  bfo.inJustDecodeBounds=false;
  try {
    File f=new File(path);
    ExifInterface exif=new ExifInterface(f.getPath());
    int orientation=exif.getAttributeInt(ExifInterface.TAG_ORIENTATION,ExifInterface.ORIENTATION_NORMAL);
    int angle=0;
    if (orientation == ExifInterface.ORIENTATION_NORMAL) {
      return BitmapFactory.decodeFile(path,bfo);
    }
 else     if (orientation == ExifInterface.ORIENTATION_ROTATE_90) {
      angle=90;
    }
 else     if (orientation == ExifInterface.ORIENTATION_ROTATE_180) {
      angle=180;
    }
 else     if (orientation == ExifInterface.ORIENTATION_ROTATE_270) {
      angle=270;
    }
    Matrix mat=new Matrix();
    mat.postRotate(angle);
    Bitmap bmp=BitmapFactory.decodeStream(new FileInputStream(f),null,bfo);
    return Bitmap.createBitmap(bmp,0,0,bmp.getWidth(),bmp.getHeight(),mat,true);
  }
 catch (  IOException e) {
    AppLog.e(T.UTILS,"Error in setting image",e);
  }
catch (  OutOfMemoryError oom) {
    AppLog.e(T.UTILS,"OutOfMemoryError Error in setting image: " + oom);
  }
  return null;
}
