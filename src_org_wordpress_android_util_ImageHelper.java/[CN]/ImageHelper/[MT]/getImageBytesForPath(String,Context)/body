{
  Uri curStream=null;
  String[] projection;
  HashMap<String,Object> mediaData=new HashMap<String,Object>();
  String title="", orientation="";
  byte[] bytes;
  if (filePath != null) {
    if (!filePath.contains("content://"))     curStream=Uri.parse("content://media" + filePath);
 else     curStream=Uri.parse(filePath);
  }
  if (curStream != null) {
    if (filePath.contains("video")) {
      int videoID=Integer.parseInt(curStream.getLastPathSegment());
      projection=new String[]{Video.Thumbnails._ID,Video.Thumbnails.DATA};
      ContentResolver crThumb=ctx.getContentResolver();
      BitmapFactory.Options options=new BitmapFactory.Options();
      options.inSampleSize=1;
      Bitmap videoBitmap=MediaStore.Video.Thumbnails.getThumbnail(crThumb,videoID,MediaStore.Video.Thumbnails.MINI_KIND,options);
      ByteArrayOutputStream stream=new ByteArrayOutputStream();
      try {
        videoBitmap.compress(Bitmap.CompressFormat.PNG,100,stream);
        bytes=stream.toByteArray();
        title="Video";
        videoBitmap=null;
      }
 catch (      Exception e) {
        return null;
      }
    }
 else {
      projection=new String[]{Images.Thumbnails._ID,Images.Thumbnails.DATA,Images.Media.ORIENTATION};
      String path="";
      Cursor cur;
      try {
        cur=ctx.getContentResolver().query(curStream,projection,null,null,null);
      }
 catch (      Exception e1) {
        return null;
      }
      File jpeg=null;
      if (cur != null) {
        String thumbData="";
        if (cur.moveToFirst()) {
          int dataColumn, orientationColumn;
          dataColumn=cur.getColumnIndex(Images.Media.DATA);
          thumbData=cur.getString(dataColumn);
          orientationColumn=cur.getColumnIndex(Images.Media.ORIENTATION);
          orientation=cur.getString(orientationColumn);
          if (orientation == null)           orientation="";
        }
        if (thumbData == null) {
          return null;
        }
        jpeg=new File(thumbData);
        path=thumbData;
      }
 else {
        path=filePath.toString().replace("file://","");
        jpeg=new File(path);
      }
      title=jpeg.getName();
      try {
        bytes=new byte[(int)jpeg.length()];
      }
 catch (      Exception e) {
        return null;
      }
catch (      OutOfMemoryError e) {
        return null;
      }
      DataInputStream in=null;
      try {
        in=new DataInputStream(new FileInputStream(jpeg));
      }
 catch (      FileNotFoundException e) {
        e.printStackTrace();
        return null;
      }
      try {
        in.readFully(bytes);
        in.close();
      }
 catch (      IOException e) {
        e.printStackTrace();
        return null;
      }
      title=jpeg.getName();
      if (orientation == "") {
        orientation=getExifOrientation(path,orientation);
      }
    }
    mediaData.put("bytes",bytes);
    mediaData.put("title",title);
    mediaData.put("orientation",orientation);
    return mediaData;
  }
 else {
    return null;
  }
}
