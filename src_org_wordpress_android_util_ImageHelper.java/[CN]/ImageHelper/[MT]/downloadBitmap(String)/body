{
  final AndroidHttpClient client=AndroidHttpClient.newInstance("Android");
  final HttpGet getRequest=new HttpGet(url);
  try {
    HttpResponse response=client.execute(getRequest);
    final int statusCode=response.getStatusLine().getStatusCode();
    if (statusCode != HttpStatus.SC_OK) {
      Log.w("ImageDownloader","Error " + statusCode + " while retrieving bitmap from "+ url);
      return null;
    }
    final HttpEntity entity=response.getEntity();
    if (entity != null) {
      InputStream inputStream=null;
      try {
        inputStream=entity.getContent();
        Bitmap bitmap=BitmapFactory.decodeStream(inputStream);
        BitmapDrawable bd=new BitmapDrawable(bitmap);
        bitmap=com.commonsware.cwac.thumbnail.ThumbnailAdapter.getRoundedCornerBitmap(bd.getBitmap());
        return bitmap;
      }
  finally {
        if (inputStream != null) {
          inputStream.close();
        }
        entity.consumeContent();
      }
    }
  }
 catch (  Exception e) {
    getRequest.abort();
    Log.w("ImageDownloader","Error while retrieving bitmap from " + url);
  }
 finally {
    if (client != null) {
      client.close();
    }
  }
  return null;
}
