{
  final StatsTaskExecutor executor=new StatsTaskExecutor();
  final String today=StatUtils.getCurrentDate();
  final String yesterday=StatUtils.getYesterdaysDate();
  executor.submitTask(new SummaryTask(blogId));
  executor.submitTask(new BarChartTask(blogId,StatsBarChartUnit.WEEK));
  executor.submitTask(new BarChartTask(blogId,StatsBarChartUnit.MONTH));
  executor.submitTask(new TopPostsAndPagesTask(blogId,today));
  executor.submitTask(new TopPostsAndPagesTask(blogId,yesterday));
  executor.submitTask(new ViewsByCountryTask(blogId,today));
  executor.submitTask(new ViewsByCountryTask(blogId,yesterday));
  executor.submitTask(new ClicksTask(blogId,today));
  executor.submitTask(new ClicksTask(blogId,yesterday));
  executor.submitTask(new ReferrersTask(blogId,today));
  executor.submitTask(new ReferrersTask(blogId,yesterday));
  executor.submitTask(new SearchEngineTermsTask(blogId,today));
  executor.submitTask(new SearchEngineTermsTask(blogId,yesterday));
  AppLog.i(T.STATS,"stats update started");
  broadcastUpdate(true);
  try {
    executor.shutdown();
    if (!executor.awaitTermination(EXECUTOR_TIMEOUT_SECONDS,TimeUnit.SECONDS)) {
      AppLog.w(T.STATS,"executor failed to terminate");
      executor.shutdownNow();
    }
  }
 catch (  InterruptedException e) {
    AppLog.e(T.STATS,e);
    executor.shutdownNow();
    Thread.currentThread().interrupt();
  }
 finally {
    AppLog.i(T.STATS,"stats update ended");
    broadcastUpdate(false);
  }
}
