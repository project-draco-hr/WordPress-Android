{
  final Plan plan=getPageAdapter().getPlan(position);
  if (isUpgradeButtonAvailable(position)) {
    String upgradeText=getString(R.string.plan_upgrade_contact_support_text,plan.getProductName());
    AlertDialog.Builder builder=new AlertDialog.Builder(this);
    builder.setMessage(upgradeText).setTitle(getString(R.string.plan_upgrade_not_available));
    builder.setPositiveButton(R.string.yes,new DialogInterface.OnClickListener(){
      public void onClick(      DialogInterface dialog,      int id){
        HelpshiftHelper.getInstance().showConversation(PlansActivity.this,HelpshiftHelper.Tag.ORIGIN_UNKNOWN);
      }
    }
);
    builder.setNegativeButton(R.string.no,new DialogInterface.OnClickListener(){
      public void onClick(      DialogInterface dialog,      int id){
      }
    }
);
    builder.create().show();
    return;
  }
  String sku=plan.getAndroidSKU();
  Blog currentBlog=WordPress.getBlog(mLocalBlogID);
  JSONObject extraData=new JSONObject();
  try {
    extraData.put("blog_id",currentBlog.getDotComBlogId());
    extraData.put("user_id",AccountHelper.getDefaultAccount().getUserId());
  }
 catch (  JSONException e) {
    AppLog.e(AppLog.T.PLANS,"Can't add extra info to purchase data!",e);
    return;
  }
  mIabHelper.launchSubscriptionPurchaseFlow(this,sku,PURCHASE_PLAN_REQUEST,new IabHelper.OnIabPurchaseFinishedListener(){
    public void onIabPurchaseFinished(    IabResult result,    Purchase info){
      if (result != null) {
        AppLog.d(AppLog.T.PLANS,"IabResult: " + result.toString());
        if (result.isSuccess()) {
          if (info != null) {
            WordPress.sUpdateIAPsWordPressCom.forceRun();
            AppLog.d(AppLog.T.PLANS,"Purchase: " + info.toString());
            AppLog.d(AppLog.T.PLANS,"You have bought the " + info.getSku() + ". Excellent choice, adventurer!");
            boolean isBusinessPlan=(mViewPager.getCurrentItem() == mViewPager.getAdapter().getCount() - 1);
            Intent intent=new Intent(PlansActivity.this,PlanPostPurchaseActivity.class);
            intent.putExtra(PlanPostPurchaseActivity.ARG_IS_BUSINESS_PLAN,isBusinessPlan);
            startActivity(intent);
          }
        }
 else {
          AppLog.e(AppLog.T.PLANS,"Purchase failure: " + result.getMessage());
        }
      }
    }
  }
,extraData.toString());
}
