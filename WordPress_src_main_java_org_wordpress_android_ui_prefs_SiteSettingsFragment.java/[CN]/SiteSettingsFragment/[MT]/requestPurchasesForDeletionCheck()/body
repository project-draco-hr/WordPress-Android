{
  final Blog currentBlog=WordPress.getCurrentBlog();
  WordPress.getRestClientUtils().getSitePurchases(currentBlog.getDotComBlogId(),new RestRequest.Listener(){
    @Override public void onResponse(    JSONObject response){
      try {
        JSONArray purchases=response.getJSONArray("originalResponse");
        if (hasActivePurchases(purchases)) {
          AlertDialog.Builder builder=new AlertDialog.Builder(getActivity());
          builder.setTitle("Premium Upgrades");
          builder.setMessage("You have active premium upgrades on your site. Please cancel your upgrades prior to deleting your site.");
          builder.setPositiveButton("Ok",new DialogInterface.OnClickListener(){
            @Override public void onClick(            DialogInterface dialog,            int which){
            }
          }
);
          builder.setNegativeButton("Show purchases",new DialogInterface.OnClickListener(){
            @Override public void onClick(            DialogInterface dialog,            int which){
              WPWebViewActivity.openUrlByUsingWPCOMCredentials(getActivity(),"https://wordpress.com/purchases?preview=true&iframe=true",AccountHelper.getCurrentUsernameForBlog(currentBlog));
            }
          }
);
          builder.show();
        }
 else {
          showDeleteSiteDialog();
        }
      }
 catch (      JSONException e) {
        e.printStackTrace();
      }
    }
  }
,new RestRequest.ErrorListener(){
    @Override public void onErrorResponse(    VolleyError error){
      ToastUtils.showToast(getActivity(),"Something went wrong. Please contact support");
      AppLog.e(AppLog.T.MAIN,error.toString());
    }
  }
);
}
