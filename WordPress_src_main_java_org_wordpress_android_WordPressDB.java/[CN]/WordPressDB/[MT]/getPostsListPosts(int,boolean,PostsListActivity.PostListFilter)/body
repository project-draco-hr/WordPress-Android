{
  PostsListPostList listPosts=new PostsListPostList();
  String[] args={Integer.toString(localBlogId),Integer.toString(loadPages ? 1 : 0)};
  String query="blogID=? AND isPage=? AND NOT (localDraft=1 AND uploaded=1)";
  if (filter != null) {
    PostStatus status;
switch (filter) {
case DRAFTS:
      status=PostStatus.DRAFT;
    break;
case SCHEDULED:
  status=PostStatus.SCHEDULED;
break;
case TRASHED:
status=PostStatus.TRASHED;
break;
default :
status=PostStatus.PUBLISHED;
break;
}
query+=" AND post_status='" + PostStatus.toString(status) + "'";
}
Cursor c=db.query(POSTS_TABLE,null,query,args,null,null,"localDraft DESC, date_created_gmt DESC");
try {
while (c.moveToNext()) {
Post post=new Post();
post.setLocalTableBlogId(localBlogId);
post.setLocalTablePostId(c.getLong(c.getColumnIndex("id")));
post.setRemotePostId(c.getString(c.getColumnIndex("postid")));
post.setTitle(StringUtils.unescapeHTML(c.getString(c.getColumnIndex("title"))));
post.setDateCreated(c.getLong(c.getColumnIndex("dateCreated")));
post.setDate_created_gmt(c.getLong(c.getColumnIndex("date_created_gmt")));
post.setCategories(c.getString(c.getColumnIndex("categories")));
post.setCustomFields(c.getString(c.getColumnIndex("custom_fields")));
post.setDescription(c.getString(c.getColumnIndex("description")));
post.setLink(c.getString(c.getColumnIndex("link")));
post.setAllowComments(SqlUtils.sqlToBool(c.getInt(c.getColumnIndex("mt_allow_comments"))));
post.setAllowPings(SqlUtils.sqlToBool(c.getInt(c.getColumnIndex("mt_allow_pings"))));
post.setPostExcerpt(c.getString(c.getColumnIndex("mt_excerpt")));
post.setKeywords(c.getString(c.getColumnIndex("mt_keywords")));
post.setMoreText(c.getString(c.getColumnIndex("mt_text_more")));
post.setPermaLink(c.getString(c.getColumnIndex("permaLink")));
post.setPostStatus(c.getString(c.getColumnIndex("post_status")));
post.setUserId(c.getString(c.getColumnIndex("userid")));
post.setAuthorDisplayName(c.getString(c.getColumnIndex("wp_author_display_name")));
post.setAuthorId(c.getString(c.getColumnIndex("wp_author_id")));
post.setPassword(c.getString(c.getColumnIndex("wp_password")));
post.setPostFormat(c.getString(c.getColumnIndex("wp_post_format")));
post.setSlug(c.getString(c.getColumnIndex("wp_slug")));
post.setMediaPaths(c.getString(c.getColumnIndex("mediaPaths")));
int latColumnIndex=c.getColumnIndex("latitude");
int lngColumnIndex=c.getColumnIndex("longitude");
if (!c.isNull(latColumnIndex) && !c.isNull(lngColumnIndex)) {
post.setLocation(c.getDouble(latColumnIndex),c.getDouble(lngColumnIndex));
}
post.setLocalDraft(SqlUtils.sqlToBool(c.getInt(c.getColumnIndex("localDraft"))));
post.setUploading(SqlUtils.sqlToBool(c.getInt(c.getColumnIndex("isUploading"))));
post.setUploaded(SqlUtils.sqlToBool(c.getInt(c.getColumnIndex("uploaded"))));
post.setIsPage(SqlUtils.sqlToBool(c.getInt(c.getColumnIndex("isPage"))));
post.setPageParentId(c.getString(c.getColumnIndex("wp_page_parent_id")));
post.setPageParentTitle(c.getString(c.getColumnIndex("wp_page_parent_title")));
post.setLocalChange(SqlUtils.sqlToBool(c.getInt(c.getColumnIndex("isLocalChange"))));
listPosts.add(new PostsListPost(post));
}
return listPosts;
}
  finally {
SqlUtils.closeCursor(c);
}
}
