{
  Log.v("WORDPRESS","Received Message");
  Bundle extras=intent.getExtras();
  if (extras == null) {
    Log.v("WORDPRESS","Hrm. No notification message content received. Aborting.");
    return;
  }
  String title=extras.getString("title");
  if (title == null)   title="WordPress";
  String message=extras.getString("msg");
  String note_id=extras.getString("from");
  int notificationId=0;
  if (note_id != null) {
    if (activeNotificationsMap.containsKey(note_id)) {
      notificationId=activeNotificationsMap.get(note_id);
    }
 else {
      notificationId=noteCounter;
      activeNotificationsMap.put(note_id,notificationId);
      noteCounter++;
    }
  }
  String iconURL=extras.getString("icon");
  Bitmap largeIconBitmap=null;
  if (iconURL != null) {
    float screenDensity=getResources().getDisplayMetrics().densityDpi;
    int size=Math.round(64 * (screenDensity / 160));
    String resizedURL=iconURL.replaceAll("(?<=[?&;])s=[0-9]*","s=" + size);
    largeIconBitmap=ImageHelper.downloadBitmap(resizedURL);
  }
  SharedPreferences prefs=PreferenceManager.getDefaultSharedPreferences(context);
  boolean sound, vibrate, light;
  sound=prefs.getBoolean("wp_pref_notification_sound",false);
  vibrate=prefs.getBoolean("wp_pref_notification_vibrate",false);
  light=prefs.getBoolean("wp_pref_notification_light",false);
  NotificationCompat.Builder mBuilder=new NotificationCompat.Builder(this).setSmallIcon(R.drawable.notification_icon).setContentTitle(title).setContentText(message).setTicker(message).setAutoCancel(true).setStyle(new NotificationCompat.BigTextStyle().bigText(message));
  String noteType=extras.getString("type");
  if (noteType != null && noteType.equals("c")) {
    Intent commentReplyIntent=new Intent(this,NotificationsActivity.class);
    PendingIntent commentReplyPendingIntent=PendingIntent.getActivity(context,0,commentReplyIntent,Intent.FLAG_ACTIVITY_NEW_TASK);
    mBuilder.addAction(R.drawable.ab_icon_reply,getResources().getText(R.string.reply),commentReplyPendingIntent);
  }
  if (largeIconBitmap != null) {
    mBuilder.setLargeIcon(largeIconBitmap);
  }
  if (sound)   mBuilder.setSound(Uri.parse("android.resource://" + getPackageName() + "/"+ R.raw.notification));
  if (vibrate)   mBuilder.setVibrate(new long[]{500,500,500});
  if (light)   mBuilder.setLights(0xff0000ff,1000,5000);
  Intent resultIntent=new Intent(this,NotificationsActivity.class);
  PendingIntent pendingIntent=PendingIntent.getActivity(context,0,resultIntent,Intent.FLAG_ACTIVITY_NEW_TASK);
  mBuilder.setContentIntent(pendingIntent);
  NotificationManager mNotificationManager=(NotificationManager)getSystemService(Context.NOTIFICATION_SERVICE);
  mNotificationManager.notify(notificationId,mBuilder.build());
}
