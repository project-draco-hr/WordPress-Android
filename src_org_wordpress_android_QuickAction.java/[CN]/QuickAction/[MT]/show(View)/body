{
  preShow();
  int xPos, yPos;
  int[] location=new int[2];
  anchor.getLocationOnScreen(location);
  Rect anchorRect=new Rect(location[0],location[1],location[0] + anchor.getWidth(),location[1] + anchor.getHeight());
  mRootView.setLayoutParams(new LayoutParams(LayoutParams.WRAP_CONTENT,LayoutParams.WRAP_CONTENT));
  mRootView.measure(LayoutParams.WRAP_CONTENT,LayoutParams.WRAP_CONTENT);
  int rootHeight=mRootView.getMeasuredHeight();
  int rootWidth=mRootView.getMeasuredWidth();
  int screenWidth=mWindowManager.getDefaultDisplay().getWidth();
  int screenHeight=mWindowManager.getDefaultDisplay().getHeight();
  if ((anchorRect.left + rootWidth) > screenWidth) {
    xPos=anchorRect.left - (rootWidth - anchor.getWidth());
  }
 else {
    if (anchor.getWidth() > rootWidth) {
      xPos=anchorRect.centerX() - (rootWidth / 2);
    }
 else {
      xPos=anchorRect.left;
    }
  }
  int dyTop=anchorRect.top;
  int dyBottom=screenHeight - anchorRect.bottom;
  boolean onTop=(dyTop > dyBottom) ? true : false;
  if (onTop) {
    if (rootHeight > dyTop) {
      yPos=15;
      LayoutParams l=mScroller.getLayoutParams();
      l.height=dyTop - anchor.getHeight();
    }
 else {
      yPos=anchorRect.top - rootHeight;
    }
  }
 else {
    yPos=anchorRect.bottom;
    if (rootHeight > dyBottom) {
      LayoutParams l=mScroller.getLayoutParams();
      l.height=dyBottom;
    }
  }
  showArrow(((onTop) ? R.id.arrow_down : R.id.arrow_up),anchorRect.centerX() - xPos);
  setAnimationStyle(screenWidth,anchorRect.centerX(),onTop);
  mWindow.showAtLocation(anchor,Gravity.NO_GRAVITY,xPos,yPos);
}
