{
  int id=v.getId();
  if (id == R.id.format_bar_button_html) {
    checkForFailedUploadAndSwitchToHtmlMode((ToggleButton)v);
  }
 else   if (id == R.id.format_bar_button_media) {
    mEditorFragmentListener.onTrackableEvent(TrackableEvent.MEDIA_BUTTON_TAPPED);
    ((ToggleButton)v).setChecked(false);
    if (mSourceView.getVisibility() == View.VISIBLE) {
      ToastUtils.showToast(getActivity(),R.string.alert_insert_image_html_mode,ToastUtils.Duration.LONG);
    }
 else {
      mEditorFragmentListener.onAddMediaClicked();
      if (isAdded()) {
        getActivity().openContextMenu(mTagToggleButtonMap.get(TAG_FORMAT_BAR_BUTTON_MEDIA));
      }
    }
  }
 else   if (id == R.id.format_bar_button_link) {
    if (!((ToggleButton)v).isChecked()) {
      mWebView.execJavaScriptFromString("ZSSEditor.unlink();");
      mEditorFragmentListener.onTrackableEvent(TrackableEvent.UNLINK_BUTTON_TAPPED);
      return;
    }
    mEditorFragmentListener.onTrackableEvent(TrackableEvent.LINK_BUTTON_TAPPED);
    ((ToggleButton)v).setChecked(false);
    LinkDialogFragment linkDialogFragment=new LinkDialogFragment();
    linkDialogFragment.setTargetFragment(this,LinkDialogFragment.LINK_DIALOG_REQUEST_CODE_ADD);
    Bundle dialogBundle=new Bundle();
    String clipboardUri=Utils.getUrlFromClipboard(getActivity());
    if (clipboardUri != null) {
      dialogBundle.putString(LinkDialogFragment.LINK_DIALOG_ARG_URL,clipboardUri);
    }
    if (mSourceView.getVisibility() == View.VISIBLE) {
      mSelectionStart=mSourceViewContent.getSelectionStart();
      mSelectionEnd=mSourceViewContent.getSelectionEnd();
      String selectedText=mSourceViewContent.getText().toString().substring(mSelectionStart,mSelectionEnd);
      dialogBundle.putString(LinkDialogFragment.LINK_DIALOG_ARG_TEXT,selectedText);
    }
 else {
      mGetSelectedTextCountDownLatch=new CountDownLatch(1);
      mWebView.execJavaScriptFromString("ZSSEditor.execFunctionForResult('getSelectedText');");
      try {
        if (mGetSelectedTextCountDownLatch.await(1,TimeUnit.SECONDS)) {
          dialogBundle.putString(LinkDialogFragment.LINK_DIALOG_ARG_TEXT,mJavaScriptResult);
        }
      }
 catch (      InterruptedException e) {
        AppLog.d(T.EDITOR,"Failed to obtain selected text from JS editor.");
      }
    }
    linkDialogFragment.setArguments(dialogBundle);
    linkDialogFragment.show(getFragmentManager(),LinkDialogFragment.class.getSimpleName());
  }
 else {
    if (v instanceof ToggleButton) {
      onFormattingButtonClicked((ToggleButton)v);
    }
  }
}
