{
  RelativeLayout.LayoutParams llParams=(android.widget.RelativeLayout.LayoutParams)linearLayout.getLayoutParams();
  Display display=getActivity().getWindowManager().getDefaultDisplay();
  linearLayout.removeAllViews();
  int maxWidth=display.getWidth() - llParams.leftMargin - llParams.rightMargin- mParentView.getPaddingLeft()- mParentView.getPaddingRight();
  if (DisplayUtils.isXLarge(getActivity())) {
    int minDialogWidth=getResources().getDimensionPixelSize(R.dimen.theme_details_dialog_min_width);
    int dialogWidth=Math.max((int)(display.getWidth() * 0.6),minDialogWidth);
    maxWidth=dialogWidth / 2 - llParams.leftMargin - llParams.rightMargin;
  }
 else   if (mLeftContainer != null && mLeftContainer.getLayoutParams() instanceof LinearLayout.LayoutParams) {
    int spec=MeasureSpec.makeMeasureSpec(0,MeasureSpec.UNSPECIFIED);
    mLeftContainer.measure(spec,spec);
    LinearLayout.LayoutParams params=(LayoutParams)mLeftContainer.getLayoutParams();
    maxWidth-=mLeftContainer.getMeasuredWidth() + params.rightMargin + params.leftMargin;
  }
  linearLayout.setOrientation(LinearLayout.VERTICAL);
  LinearLayout.LayoutParams params;
  LinearLayout newLL=new LinearLayout(context);
  newLL.setLayoutParams(new LayoutParams(LayoutParams.MATCH_PARENT,LayoutParams.WRAP_CONTENT));
  newLL.setGravity(Gravity.LEFT);
  newLL.setOrientation(LinearLayout.HORIZONTAL);
  int widthSoFar=0;
  int dp4=DisplayUtils.dpToPx(getActivity(),4);
  int dp2=DisplayUtils.dpToPx(getActivity(),2);
  for (int i=0; i < views.length; i++) {
    LinearLayout LL=new LinearLayout(context);
    LL.setOrientation(LinearLayout.HORIZONTAL);
    LL.setLayoutParams(new ListView.LayoutParams(LayoutParams.WRAP_CONTENT,LayoutParams.WRAP_CONTENT));
    views[i].measure(0,0);
    params=new LinearLayout.LayoutParams(views[i].getMeasuredWidth(),LayoutParams.WRAP_CONTENT);
    params.setMargins(0,dp2,dp4,dp2);
    LL.addView(views[i],params);
    LL.measure(0,0);
    widthSoFar+=views[i].getMeasuredWidth() + views[i].getPaddingLeft() + views[i].getPaddingRight();
    if (widthSoFar >= maxWidth) {
      linearLayout.addView(newLL);
      newLL=new LinearLayout(context);
      newLL.setLayoutParams(new LayoutParams(LayoutParams.MATCH_PARENT,LayoutParams.WRAP_CONTENT));
      newLL.setOrientation(LinearLayout.HORIZONTAL);
      newLL.setGravity(Gravity.LEFT);
      params=new LinearLayout.LayoutParams(LL.getMeasuredWidth(),LL.getMeasuredHeight());
      newLL.addView(LL,params);
      widthSoFar=LL.getMeasuredWidth();
    }
 else {
      newLL.addView(LL);
    }
  }
  linearLayout.addView(newLL);
}
