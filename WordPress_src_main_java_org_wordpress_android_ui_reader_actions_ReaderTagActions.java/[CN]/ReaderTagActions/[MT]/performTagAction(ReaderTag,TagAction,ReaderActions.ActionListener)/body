{
  if (tag == null) {
    if (actionListener != null) {
      actionListener.onActionResult(false);
    }
    return false;
  }
  if (tag.tagType == ReaderTagType.DEFAULT) {
    AppLog.w(T.READER,"cannot add or delete default tag");
    if (actionListener != null) {
      actionListener.onActionResult(false);
    }
    return false;
  }
  final String path;
  final String tagNameForApi=ReaderUtils.sanitizeWithDashes(tag.getTagSlug());
switch (action) {
case DELETE:
    ReaderTagTable.deleteTag(tag);
  path="read/tags/" + tagNameForApi + "/mine/delete";
break;
case ADD:
String endpoint="/read/tags/" + tagNameForApi + "/posts";
ReaderTag newTopic=new ReaderTag(tag.getTagSlug(),tag.getTagTitle(),endpoint,ReaderTagType.FOLLOWED);
ReaderTagTable.addOrUpdateTag(newTopic);
path="read/tags/" + tagNameForApi + "/mine/new";
break;
default :
return false;
}
com.wordpress.rest.RestRequest.Listener listener=new RestRequest.Listener(){
@Override public void onResponse(JSONObject jsonObject){
AppLog.i(T.READER,"tag action " + action.name() + " succeeded");
if (actionListener != null) {
actionListener.onActionResult(true);
}
}
}
;
RestRequest.ErrorListener errorListener=new RestRequest.ErrorListener(){
@Override public void onErrorResponse(VolleyError volleyError){
String error=VolleyUtils.errStringFromVolleyError(volleyError);
boolean isSuccess=(action == TagAction.ADD && error.equals("already_subscribed")) || (action == TagAction.DELETE && error.equals("not_subscribed"));
if (isSuccess) {
AppLog.w(T.READER,"tag action " + action.name() + " succeeded with error "+ error);
if (actionListener != null) {
actionListener.onActionResult(true);
}
return;
}
AppLog.w(T.READER,"tag action " + action.name() + " failed");
AppLog.e(T.READER,volleyError);
switch (action) {
case DELETE:
ReaderTagTable.addOrUpdateTag(tag);
break;
case ADD:
ReaderTagTable.deleteTag(tag);
break;
}
if (actionListener != null) {
actionListener.onActionResult(false);
}
}
}
;
WordPress.getRestClientUtilsV1_1().post(path,listener,errorListener);
return true;
}
