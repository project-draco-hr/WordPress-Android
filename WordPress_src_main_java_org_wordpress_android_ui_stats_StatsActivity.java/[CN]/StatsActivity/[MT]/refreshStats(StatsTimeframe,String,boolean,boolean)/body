{
  final Blog currentBlog=WordPress.getBlog(mLocalBlogID);
  if (currentBlog == null) {
    AppLog.w(T.STATS,"Current blog is null. This should never happen here.");
    mSwipeToRefreshHelper.setRefreshing(false);
    return;
  }
  if (!NetworkUtils.checkConnection(this)) {
    mSwipeToRefreshHelper.setRefreshing(false);
    AppLog.w(AppLog.T.STATS,"StatsActivity > no connection, update canceled");
    return;
  }
  final String blogId=StatsUtils.getBlogId(mLocalBlogID);
  if (blogId != null) {
    if (!currentBlog.isDotcomFlag() && !currentBlog.hasValidJetpackCredentials() && mResultCode != RESULT_CANCELED) {
      if (WordPress.hasDotComToken(this)) {
        SharedPreferences settings=PreferenceManager.getDefaultSharedPreferences(this);
        String username=settings.getString(WordPress.WPCOM_USERNAME_PREFERENCE,null);
        currentBlog.setDotcom_username(username);
        WordPress.wpDB.saveBlog(currentBlog);
        mSwipeToRefreshHelper.setRefreshing(true);
      }
 else {
        startWPComLoginActivity();
        return;
      }
    }
  }
 else {
    if (!currentBlog.isDotcomFlag()) {
      new ApiHelper.RefreshBlogContentTask(currentBlog,new VerifyJetpackSettingsCallback()).execute(false);
    }
 else {
      Toast.makeText(this,R.string.error_refresh_stats,Toast.LENGTH_LONG).show();
      AppLog.e(T.STATS,"blogID is null for a wpcom blog!! " + currentBlog.getHomeURL());
    }
    return;
  }
  if (!currentBlog.isDotcomFlag() && !currentBlog.hasValidJetpackCredentials() && !WordPress.hasDotComToken(this)) {
    mSwipeToRefreshHelper.setRefreshing(false);
    AppLog.w(T.STATS,"Jetpack blog with no wpcom credentials");
    return;
  }
  mIsUpdatingStats=true;
  Intent intent=new Intent(this,StatsService.class);
  intent.putExtra(StatsService.ARG_BLOG_ID,blogId);
  intent.putExtra(StatsService.ARG_PERIOD,timeframe);
  intent.putExtra(StatsService.ARG_DATE,date);
  intent.putExtra(StatsService.ARG_UPDATE_ALLTIME_STATS,updateAlltimeStats);
  intent.putExtra(StatsService.ARG_UPDATE_GRAPH_STATS,updateGraph);
  startService(intent);
}
