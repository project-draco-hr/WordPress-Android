{
  if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.GINGERBREAD) {
    HurlStack stack=new HurlStack(){
      @Override public HttpResponse performRequest(      Request<?> request,      Map<String,String> headers) throws IOException, AuthFailureError {
        if (request.getUrl() != null && !StringUtils.getHost(request.getUrl()).endsWith("wordpress.com")) {
          HashMap<String,String> authParams=new HashMap<String,String>();
          String creds=String.format("%s:%s",httpuser,httppasswd);
          String auth="Basic " + Base64.encodeToString(creds.getBytes(),Base64.DEFAULT);
          authParams.put("Authorization",auth);
          headers.putAll(authParams);
        }
        HashMap<String,String> defaultHeaders=new HashMap<String,String>();
        defaultHeaders.put("User-Agent","wp-android/" + WordPress.versionName);
        headers.putAll(defaultHeaders);
        return super.performRequest(request,headers);
      }
    }
;
    return stack;
  }
 else {
    HttpClientStack stack=new HttpClientStack(AndroidHttpClient.newInstance("volley/0")){
      @Override public HttpResponse performRequest(      Request<?> request,      Map<String,String> headers) throws IOException, AuthFailureError {
        if (request.getUrl() != null && !StringUtils.getHost(request.getUrl()).endsWith("wordpress.com")) {
          HashMap<String,String> authParams=new HashMap<String,String>();
          String creds=String.format("%s:%s",httpuser,httppasswd);
          String auth="Basic " + Base64.encodeToString(creds.getBytes(),Base64.DEFAULT);
          authParams.put("Authorization",auth);
          headers.putAll(authParams);
        }
        HashMap<String,String> defaultHeaders=new HashMap<String,String>();
        defaultHeaders.put("User-Agent","wp-android/" + WordPress.versionName);
        headers.putAll(defaultHeaders);
        return super.performRequest(request,headers);
      }
    }
;
    return stack;
  }
}
