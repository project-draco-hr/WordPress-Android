{
  mErrorUnavailableVideoPress=false;
  post=posts[0];
  nm=(NotificationManager)SystemServiceFactory.get(context,Context.NOTIFICATION_SERVICE);
  String postOrPage=(String)(post.isPage() ? context.getResources().getText(R.string.page_id) : context.getResources().getText(R.string.post_id));
  String message=context.getResources().getText(R.string.uploading) + " " + postOrPage;
  n=new Notification(R.drawable.notification_icon,message,System.currentTimeMillis());
  Intent notificationIntent=new Intent(context,post.isPage() ? PagesActivity.class : PostsActivity.class);
  notificationIntent.addFlags(Intent.FLAG_ACTIVITY_CLEAR_TOP | Intent.FLAG_ACTIVITY_NEW_TASK | IntentCompat.FLAG_ACTIVITY_CLEAR_TASK);
  notificationIntent.setAction(Intent.ACTION_MAIN);
  notificationIntent.addCategory(Intent.CATEGORY_LAUNCHER);
  notificationIntent.setData((Uri.parse("custom://wordpressNotificationIntent" + post.getLocalTableBlogId())));
  notificationIntent.putExtra(PostsActivity.EXTRA_VIEW_PAGES,post.isPage());
  PendingIntent pendingIntent=PendingIntent.getActivity(context,0,notificationIntent,Intent.FLAG_ACTIVITY_CLEAR_TOP);
  n.setLatestEventInfo(context,message,message,pendingIntent);
  notificationID=(new Random()).nextInt() + post.getLocalTableBlogId();
  nm.notify(notificationID,n);
  Blog blog=WordPress.wpDB.instantiateBlogByLocalId(post.getLocalTableBlogId());
  if (blog == null) {
    mErrorMessage=context.getString(R.string.blog_not_found);
    return false;
  }
  boolean isFirstTimePublishing=false;
  if (TextUtils.isEmpty(post.getPostStatus())) {
    post.setPostStatus("publish");
  }
  if (post.hasChangedFromLocalDraftToPublished()) {
    isFirstTimePublishing=true;
  }
  if (!post.isUploaded() && post.getPostStatus().equals("publish")) {
    isFirstTimePublishing=true;
  }
  Boolean publishThis=false;
  Boolean hasImage=false;
  Boolean hasVideo=false;
  Boolean hasCategory=false;
  Boolean hasTag=!post.getKeywords().equals("");
  String descriptionContent="", moreContent="";
  int moreCount=1;
  if (!TextUtils.isEmpty(post.getMoreText()))   moreCount++;
  String imgTags="<img[^>]+android-uri\\s*=\\s*['\"]([^'\"]+)['\"][^>]*>";
  Pattern pattern=Pattern.compile(imgTags);
  for (int x=0; x < moreCount; x++) {
    if (x == 0)     descriptionContent=post.getDescription();
 else     moreContent=post.getMoreText();
    Matcher matcher;
    if (x == 0) {
      matcher=pattern.matcher(descriptionContent);
    }
 else {
      matcher=pattern.matcher(moreContent);
    }
    List<String> imageTags=new ArrayList<String>();
    while (matcher.find()) {
      imageTags.add(matcher.group());
    }
    for (    String tag : imageTags) {
      Pattern p=Pattern.compile("android-uri=\"([^\"]+)\"");
      Matcher m=p.matcher(tag);
      if (m.find()) {
        String imgPath=m.group(1);
        if (!imgPath.equals("")) {
          MediaFile mf=WordPress.wpDB.getMediaFile(imgPath,post);
          if (mf != null) {
            if (mf.isVideo()) {
              hasVideo=true;
            }
 else {
              hasImage=true;
            }
            String imgHTML=uploadMediaFile(mf,blog);
            if (imgHTML != null) {
              if (x == 0) {
                descriptionContent=descriptionContent.replace(tag,imgHTML);
              }
 else {
                moreContent=moreContent.replace(tag,imgHTML);
              }
            }
 else {
              if (x == 0)               descriptionContent=descriptionContent.replace(tag,"");
 else               moreContent=moreContent.replace(tag,"");
              mIsMediaError=true;
            }
          }
        }
      }
    }
  }
  if (mIsMediaError)   return false;
  JSONArray categoriesJsonArray=post.getJSONCategories();
  String[] postCategories=null;
  if (categoriesJsonArray != null) {
    if (categoriesJsonArray.length() > 0) {
      hasCategory=true;
    }
    postCategories=new String[categoriesJsonArray.length()];
    for (int i=0; i < categoriesJsonArray.length(); i++) {
      try {
        postCategories[i]=TextUtils.htmlEncode(categoriesJsonArray.getString(i));
      }
 catch (      JSONException e) {
        AppLog.e(T.POSTS,e);
      }
    }
  }
  Map<String,Object> contentStruct=new HashMap<String,Object>();
  if (!post.isPage() && post.isLocalDraft()) {
    SharedPreferences prefs=PreferenceManager.getDefaultSharedPreferences(context);
    if (prefs.getBoolean("wp_pref_signature_enabled",false)) {
      String tagline=prefs.getString("wp_pref_post_signature","");
      if (!TextUtils.isEmpty(tagline)) {
        String tag="\n\n<span class=\"post_sig\">" + tagline + "</span>\n\n";
        if (TextUtils.isEmpty(moreContent))         descriptionContent+=tag;
 else         moreContent+=tag;
      }
    }
  }
  if (!post.isPage()) {
    if (!TextUtils.isEmpty(post.getPostFormat())) {
      contentStruct.put("wp_post_format",post.getPostFormat());
    }
  }
  contentStruct.put("post_type",(post.isPage()) ? "page" : "post");
  contentStruct.put("title",post.getTitle());
  long pubDate=post.getDate_created_gmt();
  if (pubDate != 0) {
    Date date_created_gmt=new Date(pubDate);
    contentStruct.put("date_created_gmt",date_created_gmt);
    Date dateCreated=new Date(pubDate + (date_created_gmt.getTimezoneOffset() * 60000));
    contentStruct.put("dateCreated",dateCreated);
  }
  if (!moreContent.equals("")) {
    descriptionContent=descriptionContent.trim() + "<!--more-->" + moreContent;
    post.setMoreText("");
  }
  if (post.isLocalDraft()) {
    descriptionContent=descriptionContent.replace("<p>","").replace("</p>","\n").replace("<br>","");
  }
  descriptionContent=descriptionContent.replaceAll("\uFFFC","");
  contentStruct.put("description",descriptionContent);
  if (!post.isPage()) {
    contentStruct.put("mt_keywords",post.getKeywords());
    if (postCategories != null && postCategories.length > 0)     contentStruct.put("categories",postCategories);
  }
  contentStruct.put("mt_excerpt",post.getPostExcerpt());
  contentStruct.put((post.isPage()) ? "page_status" : "post_status",post.getPostStatus());
  if (post.supportsLocation()) {
    JSONObject remoteGeoLatitude=post.getCustomField("geo_latitude");
    JSONObject remoteGeoLongitude=post.getCustomField("geo_longitude");
    JSONObject remoteGeoPublic=post.getCustomField("geo_public");
    Map<Object,Object> hLatitude=new HashMap<Object,Object>();
    Map<Object,Object> hLongitude=new HashMap<Object,Object>();
    Map<Object,Object> hPublic=new HashMap<Object,Object>();
    try {
      if (remoteGeoLatitude != null) {
        hLatitude.put("id",remoteGeoLatitude.getInt("id"));
      }
      if (remoteGeoLongitude != null) {
        hLongitude.put("id",remoteGeoLongitude.getInt("id"));
      }
      if (remoteGeoPublic != null) {
        hPublic.put("id",remoteGeoPublic.getInt("id"));
      }
      if (post.hasLocation()) {
        PostLocation location=post.getLocation();
        if (!hLatitude.containsKey("id")) {
          hLatitude.put("key","geo_latitude");
        }
        if (!hLongitude.containsKey("id")) {
          hLongitude.put("key","geo_longitude");
        }
        if (!hPublic.containsKey("id")) {
          hPublic.put("key","geo_public");
        }
        hLatitude.put("value",location.getLatitude());
        hLongitude.put("value",location.getLongitude());
        hPublic.put("value",1);
      }
    }
 catch (    JSONException e) {
      AppLog.e(T.EDITOR,e);
    }
    if (!hLatitude.isEmpty() && !hLongitude.isEmpty() && !hPublic.isEmpty()) {
      Object[] geo={hLatitude,hLongitude,hPublic};
      contentStruct.put("custom_fields",geo);
    }
  }
  if (featuredImageID != -1) {
    contentStruct.put("wp_post_thumbnail",featuredImageID);
  }
  XMLRPCClientInterface client=XMLRPCFactory.instantiate(blog.getUri(),blog.getHttpuser(),blog.getHttppassword());
  if (!TextUtils.isEmpty(post.getQuickPostType())) {
    client.addQuickPostHeader(post.getQuickPostType());
  }
  n.setLatestEventInfo(context,message,message,n.contentIntent);
  nm.notify(notificationID,n);
  contentStruct.put("wp_password",post.getPassword());
  Object[] params;
  if (post.isLocalDraft() && !post.isUploaded())   params=new Object[]{blog.getRemoteBlogId(),blog.getUsername(),blog.getPassword(),contentStruct,publishThis};
 else   params=new Object[]{post.getRemotePostId(),blog.getUsername(),blog.getPassword(),contentStruct,publishThis};
  try {
    if (post.isLocalDraft() && !post.isUploaded()) {
      Object newPostId=client.call("metaWeblog.newPost",params);
      if (newPostId instanceof String) {
        post.setRemotePostId((String)newPostId);
      }
    }
 else {
      client.call("metaWeblog.editPost",params);
    }
    post.setUploaded(true);
    post.setLocalChange(false);
    WordPress.wpDB.updatePost(post);
    if (isFirstTimePublishing) {
      if (hasImage) {
        AnalyticsTracker.track(AnalyticsTracker.Stat.EDITOR_PUBLISHED_POST_WITH_PHOTO);
      }
      if (hasVideo) {
        AnalyticsTracker.track(AnalyticsTracker.Stat.EDITOR_PUBLISHED_POST_WITH_VIDEO);
      }
      if (hasCategory) {
        AnalyticsTracker.track(AnalyticsTracker.Stat.EDITOR_PUBLISHED_POST_WITH_CATEGORIES);
      }
      if (hasTag) {
        AnalyticsTracker.track(AnalyticsTracker.Stat.EDITOR_PUBLISHED_POST_WITH_TAGS);
      }
    }
    return true;
  }
 catch (  final XMLRPCException e) {
    setUploadPostErrorMessage(e);
  }
catch (  IOException e) {
    setUploadPostErrorMessage(e);
  }
catch (  XmlPullParserException e) {
    setUploadPostErrorMessage(e);
  }
  return false;
}
