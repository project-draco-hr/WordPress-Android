{
  setContentView(R.layout.home);
  setTitle(getResources().getText(R.string.app_name));
  WordPressDB settingsDB=new WordPressDB(this);
  accounts=settingsDB.getAccounts(this);
  checkStats(accounts.size());
  ListView listView=(ListView)findViewById(android.R.id.list);
  ImageView iv=new ImageView(this);
  iv.setBackgroundDrawable(getResources().getDrawable(R.drawable.list_divider));
  listView.addFooterView(iv);
  listView.setVerticalFadingEdgeEnabled(false);
  listView.setVerticalScrollBarEnabled(true);
  listView.setOnItemClickListener(new OnItemClickListener(){
    public void onItemClick(    AdapterView<?> arg0,    View row,    int position,    long id){
      Bundle bundle=new Bundle();
      bundle.putString("accountName",EscapeUtils.unescapeHtml(blogNames[position]));
      bundle.putString("id",String.valueOf(row.getId()));
      Intent viewPostsIntent=new Intent(wpAndroid.this,TabView.class);
      viewPostsIntent.putExtras(bundle);
      startActivityForResult(viewPostsIntent,1);
    }
  }
);
  listView.setOnCreateContextMenuListener(new OnCreateContextMenuListener(){
    public void onCreateContextMenu(    ContextMenu menu,    View v,    ContextMenuInfo menuInfo){
      AdapterView.AdapterContextMenuInfo info=(AdapterView.AdapterContextMenuInfo)menuInfo;
      View row=info.targetView;
      selectedID=String.valueOf(row.getId());
      menu.add(0,0,0,getResources().getText(R.string.remove_account));
    }
  }
);
  if (accounts.size() > 0) {
    setTitle(getResources().getText(R.string.app_name) + " - " + getResources().getText(R.string.blogs));
    ScrollView sv=new ScrollView(this);
    sv.setLayoutParams(new LayoutParams(LayoutParams.FILL_PARENT,LayoutParams.WRAP_CONTENT));
    LinearLayout layout=new LinearLayout(this);
    layout.setPadding(10,10,10,0);
    layout.setLayoutParams(new LayoutParams(LayoutParams.FILL_PARENT,LayoutParams.WRAP_CONTENT));
    layout.setOrientation(LinearLayout.VERTICAL);
    blogNames=new String[accounts.size()];
    accountIDs=new String[accounts.size()];
    accountUsers=new String[accounts.size()];
    blavatars=new String[accounts.size()];
    int validBlogCtr=0;
    for (int i=0; i < accounts.size(); i++) {
      HashMap<?,?> curHash=(HashMap<?,?>)accounts.get(i);
      if (curHash.get("blogName") == null) {
        String deleteID=curHash.get("id").toString();
        settingsDB.deleteAccount(this,deleteID);
        if (validBlogCtr > 0) {
          validBlogCtr--;
        }
      }
 else {
        blogNames[validBlogCtr]=curHash.get("blogName").toString();
        accountUsers[validBlogCtr]=curHash.get("username").toString();
        accountIDs[validBlogCtr]=curHash.get("id").toString();
        String url=curHash.get("url").toString();
        url=url.replace("http://","");
        url=url.replace("https://","");
        String[] urlSplit=url.split("/");
        url=urlSplit[0];
        url="http://gravatar.com/blavatar/" + ViewComments.getMd5Hash(url.trim()) + "?s=60&d=404";
        blavatars[validBlogCtr]=url;
        accountNames.add(validBlogCtr,blogNames[i]);
        validBlogCtr++;
      }
    }
    if (validBlogCtr < accounts.size()) {
      accounts=settingsDB.getAccounts(this);
    }
    ThumbnailBus bus=new ThumbnailBus();
    thumbs=new ThumbnailAdapter(this,new HomeListAdapter(this),new SimpleWebImageCache<ThumbnailBus,ThumbnailMessage>(null,null,101,bus),IMAGE_IDS);
    setListAdapter(thumbs);
    Intent intent=new Intent(wpAndroid.this,CommentBroadcastReceiver.class);
    PendingIntent pIntent=PendingIntent.getBroadcast(wpAndroid.this,0,intent,0);
    AlarmManager alarmManager=(AlarmManager)getSystemService(ALARM_SERVICE);
    String updateInterval=settingsDB.getInterval(wpAndroid.this);
    if (updateInterval == "") {
      updateInterval="1 Hour";
    }
    int UPDATE_INTERVAL=3600000;
    if (updateInterval.equals("5 Minutes")) {
      UPDATE_INTERVAL=300000;
    }
 else     if (updateInterval.equals("10 Minutes")) {
      UPDATE_INTERVAL=600000;
    }
 else     if (updateInterval.equals("15 Minutes")) {
      UPDATE_INTERVAL=900000;
    }
 else     if (updateInterval.equals("30 Minutes")) {
      UPDATE_INTERVAL=1800000;
    }
 else     if (updateInterval.equals("1 Hour")) {
      UPDATE_INTERVAL=3600000;
    }
 else     if (updateInterval.equals("3 Hours")) {
      UPDATE_INTERVAL=10800000;
    }
 else     if (updateInterval.equals("6 Hours")) {
      UPDATE_INTERVAL=21600000;
    }
 else     if (updateInterval.equals("12 Hours")) {
      UPDATE_INTERVAL=43200000;
    }
 else     if (updateInterval.equals("Daily")) {
      UPDATE_INTERVAL=86400000;
    }
    alarmManager.setRepeating(AlarmManager.RTC_WAKEUP,System.currentTimeMillis() + (5 * 1000),UPDATE_INTERVAL,pIntent);
  }
 else {
    Intent i=new Intent(wpAndroid.this,NewAccount.class);
    startActivityForResult(i,0);
  }
}
