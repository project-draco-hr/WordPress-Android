{
  File cacheDir;
  if (android.os.Environment.getExternalStorageState().equals(android.os.Environment.MEDIA_MOUNTED))   cacheDir=new File(android.os.Environment.getExternalStorageDirectory() + "/WordPress/images");
 else {
    cacheDir=context.getApplicationContext().getCacheDir();
  }
  if (!cacheDir.exists())   cacheDir.mkdirs();
  try {
    InputStream input;
    if (imageUri.toString().startsWith("content://")) {
      input=context.getContentResolver().openInputStream(imageUri);
    }
 else {
      input=new URL(imageUri.toString()).openStream();
    }
    String fileName="wp-" + System.currentTimeMillis();
    File f=new File(cacheDir,fileName);
    OutputStream output=new FileOutputStream(f);
    byte data[]=new byte[1024];
    int count;
    while ((count=input.read(data)) != -1) {
      output.write(data,0,count);
    }
    output.flush();
    output.close();
    input.close();
    Uri newUri=Uri.fromFile(f);
    return newUri;
  }
 catch (  Exception e) {
    e.printStackTrace();
  }
  return null;
}
