{
  String state=android.os.Environment.getExternalStorageState();
  if (!state.equals(android.os.Environment.MEDIA_MOUNTED)) {
    AlertDialog.Builder dialogBuilder=new AlertDialog.Builder(activity);
    dialogBuilder.setTitle(activity.getResources().getText(R.string.sdcard_title));
    dialogBuilder.setMessage(activity.getResources().getText(R.string.sdcard_message));
    dialogBuilder.setPositiveButton(activity.getString(R.string.ok),new DialogInterface.OnClickListener(){
      public void onClick(      DialogInterface dialog,      int whichButton){
        dialog.dismiss();
      }
    }
);
    dialogBuilder.setCancelable(true);
    dialogBuilder.create().show();
  }
 else {
    String dcimFolderName=Environment.DIRECTORY_DCIM;
    if (dcimFolderName == null)     dcimFolderName="DCIM";
    String mediaCapturePath=Environment.getExternalStorageDirectory() + File.separator + dcimFolderName+ File.separator+ "Camera"+ File.separator+ "wp-"+ System.currentTimeMillis()+ ".jpg";
    Intent takePictureFromCameraIntent=new Intent(MediaStore.ACTION_IMAGE_CAPTURE);
    takePictureFromCameraIntent.putExtra(android.provider.MediaStore.EXTRA_OUTPUT,Uri.fromFile(new File(mediaCapturePath)));
    if (callback != null) {
      callback.onMediaCapturePathReady(mediaCapturePath);
    }
    File directory=new File(mediaCapturePath).getParentFile();
    if (!directory.exists() && !directory.mkdirs()) {
      try {
        throw new IOException("Path to file could not be created.");
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
    }
    activity.startActivityForResult(takePictureFromCameraIntent,RequestCode.ACTIVITY_REQUEST_CODE_TAKE_PHOTO);
  }
}
