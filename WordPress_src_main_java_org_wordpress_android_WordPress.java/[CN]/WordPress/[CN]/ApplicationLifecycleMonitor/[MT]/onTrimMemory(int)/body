{
  if (level == ComponentCallbacks2.TRIM_MEMORY_UI_HIDDEN) {
    isInBackground=true;
    String lastActivityString=UserPrefs.getLastActivityStr();
    ActivityId lastActivity=ActivityId.getActivityIdFromName(lastActivityString);
    Map<String,String> properties=new HashMap<String,String>();
    properties.put("last_visible_screen",lastActivity.toString());
    AnalyticsTracker.track(AnalyticsTracker.Stat.APPLICATION_CLOSED,properties);
    AnalyticsTracker.endSession(false);
  }
 else {
    isInBackground=false;
  }
  if (level < ComponentCallbacks2.TRIM_MEMORY_UI_HIDDEN && mBitmapCache != null) {
    mBitmapCache.evictAll();
  }
}
