{
  if (WordPress.hasValidWPComCredentials(ctx)) {
    String token=null;
    try {
      GCMRegistrar.checkDevice(ctx);
      GCMRegistrar.checkManifest(ctx);
      token=GCMRegistrar.getRegistrationId(ctx);
      String gcmId=BuildConfig.GCM_ID;
      if (gcmId != null && token.equals("")) {
        GCMRegistrar.register(ctx,gcmId);
      }
 else {
        NotificationUtils.registerDeviceForPushNotifications(ctx,token);
        AppLog.v(T.NOTIFS,"Already registered for GCM");
      }
    }
 catch (    Exception e) {
      AppLog.e(T.NOTIFS,"Could not register for GCM: " + e.getMessage());
    }
  }
}
