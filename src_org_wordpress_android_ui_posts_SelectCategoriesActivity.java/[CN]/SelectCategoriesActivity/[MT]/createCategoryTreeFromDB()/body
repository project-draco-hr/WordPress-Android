{
  List<String> stringCategories=WordPress.wpDB.loadCategories(blog.getId());
  SparseArray<CategoryNode> categoryMap=new SparseArray<CategoryNode>();
  mCategories=new CategoryNode(null);
  CategoryNode currentRootNode;
  for (  String name : stringCategories) {
    int categoryId=WordPress.wpDB.getCategoryId(blog.getId(),name);
    int parentId=WordPress.wpDB.getCategoryParentId(blog.getId(),name);
    Category newCategory=new Category(categoryId,parentId,name);
    CategoryNode node=new CategoryNode(newCategory);
    categoryMap.put(newCategory.getCategoryId(),node);
  }
  for (int i=0; i < categoryMap.size(); i++) {
    Category category=categoryMap.valueAt(i).category;
    if (category.getParentId() == 0) {
      currentRootNode=mCategories;
    }
 else {
      currentRootNode=categoryMap.get(category.getParentId());
    }
    currentRootNode.children.put(category.getName(),categoryMap.get(category.getCategoryId()));
  }
  if (stringCategories.size() > 0) {
    populateCategoryList();
  }
 else {
    refreshCategories();
  }
}
