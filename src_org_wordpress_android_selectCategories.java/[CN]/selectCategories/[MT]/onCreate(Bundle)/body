{
  super.onCreate(icicle);
  setContentView(R.layout.select_categories);
  setTitle(getResources().getString(R.string.select_categories));
  final ListView lv=getListView();
  lv.setItemsCanFocus(false);
  Bundle extras=getIntent().getExtras();
  if (extras != null) {
    id=extras.getString("id");
    checkedCategories=extras.getLongArray("checkedCategories");
    categoriesCSV=extras.getString("categoriesCSV");
  }
  loadCategories();
  customButton done=(customButton)findViewById(R.id.categories_done);
  done.setOnClickListener(new customButton.OnClickListener(){
    public void onClick(    View v){
      String selectedCategories="";
      long checkedItems[]=lv.getCheckItemIds();
      SparseBooleanArray selectedItems=lv.getCheckedItemPositions();
      int ctr=0;
      Vector rCheckedItems=new Vector();
      for (int i=0; i < selectedItems.size(); i++) {
        if (selectedItems.get(selectedItems.keyAt(i)) == true) {
          rCheckedItems.add(selectedItems.keyAt(i));
          selectedCategories+=loadTextArray.get(selectedItems.keyAt(i)).toString() + ",";
        }
      }
      long finalCheckedItems[]=new long[rCheckedItems.size()];
      for (int x=0; x < rCheckedItems.size(); x++) {
        finalCheckedItems[x]=Long.parseLong(rCheckedItems.get(x).toString());
      }
      Bundle bundle=new Bundle();
      selectedCategories=selectedCategories.trim();
      if (selectedCategories.endsWith(",")) {
        selectedCategories=selectedCategories.substring(0,selectedCategories.length() - 1);
      }
      bundle.putString("selectedCategories",selectedCategories);
      bundle.putLongArray("checkedItems",finalCheckedItems);
      Intent mIntent=new Intent();
      mIntent.putExtras(bundle);
      setResult(RESULT_OK,mIntent);
      finish();
    }
  }
);
  customButton cancel=(customButton)findViewById(R.id.categories_cancel);
  cancel.setOnClickListener(new customButton.OnClickListener(){
    public void onClick(    View v){
      Bundle bundle=new Bundle();
      Intent mIntent=new Intent();
      mIntent.putExtras(bundle);
      setResult(RESULT_CANCELED,mIntent);
      finish();
    }
  }
);
  final customImageButton refreshCategoriesButton=(customImageButton)findViewById(R.id.refreshCategoriesButton);
  refreshCategoriesButton.setOnClickListener(new customImageButton.OnClickListener(){
    public void onClick(    View v){
      pd=ProgressDialog.show(selectCategories.this,getResources().getText(R.string.refreshing_categories),getResources().getText(R.string.attempting_categories_refresh),true,true);
      Thread th=new Thread(){
        public void run(){
          finalResult=getCategories();
          mHandler.post(mUpdateResults);
        }
      }
;
      th.start();
    }
  }
);
}
