{
  super.onCreate(icicle);
  setContentView(R.layout.select_categories);
  setTitle(getResources().getString(R.string.select_categories));
  final ListView lv=getListView();
  lv.setChoiceMode(ListView.CHOICE_MODE_MULTIPLE);
  lv.setItemsCanFocus(false);
  Bundle extras=getIntent().getExtras();
  if (extras != null) {
    id=extras.getString("id");
    checkedCategories=extras.getLongArray("checkedCategories");
    categoriesCSV=extras.getString("categoriesCSV");
  }
  loadCategories();
  final ImageButton addCategory=(ImageButton)findViewById(R.id.newCategory);
  addCategory.setOnClickListener(new ImageButton.OnClickListener(){
    public void onClick(    View v){
      Bundle bundle=new Bundle();
      bundle.putString("id",id);
      Intent i=new Intent(selectCategories.this,addCategory.class);
      i.putExtras(bundle);
      startActivityForResult(i,0);
    }
  }
);
  Button categoriesDone=(Button)findViewById(R.id.categories_done);
  categoriesDone.setOnClickListener(new Button.OnClickListener(){
    public void onClick(    View v){
      String selectedCategories="";
      SparseBooleanArray selectedItems=lv.getCheckedItemPositions();
      Vector<Integer> rCheckedItems=new Vector();
      for (int i=0; i < selectedItems.size(); i++) {
        if (selectedItems.get(selectedItems.keyAt(i)) == true) {
          rCheckedItems.add(selectedItems.keyAt(i));
          selectedCategories+=loadTextArray.get(selectedItems.keyAt(i)).toString() + ",";
        }
      }
      long finalCheckedItems[]=new long[rCheckedItems.size()];
      for (int x=0; x < rCheckedItems.size(); x++) {
        finalCheckedItems[x]=Long.parseLong(rCheckedItems.get(x).toString());
      }
      Bundle bundle=new Bundle();
      selectedCategories=selectedCategories.trim();
      if (selectedCategories.endsWith(",")) {
        selectedCategories=selectedCategories.substring(0,selectedCategories.length() - 1);
      }
      bundle.putString("selectedCategories",selectedCategories);
      bundle.putLongArray("checkedItems",finalCheckedItems);
      Intent mIntent=new Intent();
      mIntent.putExtras(bundle);
      setResult(RESULT_OK,mIntent);
      finish();
    }
  }
);
}
