{
  mActivity=(NewEditPostActivity)getActivity();
  final ViewGroup rootView=(ViewGroup)inflater.inflate(R.layout.fragment_edit_post_content,container,false);
  if (rootView != null && rootView.getViewTreeObserver() != null) {
    rootView.getViewTreeObserver().addOnGlobalLayoutListener(new ViewTreeObserver.OnGlobalLayoutListener(){
      @Override public void onGlobalLayout(){
        int heightDiff=rootView.getRootView().getHeight() - rootView.getHeight();
        if (heightDiff < Utils.dpToPx(100)) {
          if (!mActivity.getSupportActionBar().isShowing())           setContentEditingModeVisible(false);
        }
      }
    }
);
  }
  mFormatBar=(RelativeLayout)rootView.findViewById(R.id.format_bar);
  mTitleEditText=(EditText)rootView.findViewById(R.id.post_title);
  mContentEditText=(WPEditText)rootView.findViewById(R.id.post_content);
  mBoldToggleButton=(ToggleButton)rootView.findViewById(R.id.bold);
  mEmToggleButton=(ToggleButton)rootView.findViewById(R.id.em);
  mBquoteToggleButton=(ToggleButton)rootView.findViewById(R.id.bquote);
  mUnderlineToggleButton=(ToggleButton)rootView.findViewById(R.id.underline);
  mStrikeToggleButton=(ToggleButton)rootView.findViewById(R.id.strike);
  mAddPictureButton=(ImageButton)rootView.findViewById(R.id.addPictureButton);
  Button linkButton=(Button)rootView.findViewById(R.id.link);
  Button moreButton=(Button)rootView.findViewById(R.id.more);
  registerForContextMenu(mAddPictureButton);
  mContentEditText.setOnSelectionChangedListener(this);
  mContentEditText.setOnTouchListener(this);
  mContentEditText.addTextChangedListener(this);
  mAddPictureButton.setOnClickListener(mFormatBarButtonClickListener);
  mBoldToggleButton.setOnClickListener(mFormatBarButtonClickListener);
  linkButton.setOnClickListener(mFormatBarButtonClickListener);
  mEmToggleButton.setOnClickListener(mFormatBarButtonClickListener);
  mUnderlineToggleButton.setOnClickListener(mFormatBarButtonClickListener);
  mStrikeToggleButton.setOnClickListener(mFormatBarButtonClickListener);
  mBquoteToggleButton.setOnClickListener(mFormatBarButtonClickListener);
  moreButton.setOnClickListener(mFormatBarButtonClickListener);
  mPost=mActivity.getPost();
  if (mPost != null) {
    if (!TextUtils.isEmpty(mPost.getContent())) {
      if (mPost.isLocalDraft())       mContentEditText.setText(WPHtml.fromHtml(mPost.getContent().replaceAll("\uFFFC",""),mActivity,mPost));
 else       mContentEditText.setText(mPost.getContent().replaceAll("\uFFFC",""));
    }
    if (!TextUtils.isEmpty(mPost.getTitle())) {
      mTitleEditText.setText(mPost.getTitle());
    }
  }
  mContentEditText.setOnFocusChangeListener(new View.OnFocusChangeListener(){
    @Override public void onFocusChange(    View v,    boolean hasFocus){
      if (mPost != null && hasFocus) {
        setContentEditingModeVisible(true);
      }
    }
  }
);
  mContentEditText.setOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      if (mActivity != null && mActivity.getSupportActionBar().isShowing()) {
        setContentEditingModeVisible(true);
      }
    }
  }
);
  setContentEditTextFocusable(true);
  String action=mActivity.getIntent().getAction();
  if (Intent.ACTION_SEND.equals(action) || Intent.ACTION_SEND_MULTIPLE.equals(action))   setPostContentFromShareAction();
 else   if (NEW_MEDIA_GALLERY.equals(action))   prepareMediaGallery();
 else   if (NEW_MEDIA_POST.equals(action))   prepareMediaPost();
 else   if (mQuickMediaType >= 0) {
    if (mQuickMediaType == Constants.QUICK_POST_PHOTO_CAMERA)     launchCamera();
 else     if (mQuickMediaType == Constants.QUICK_POST_PHOTO_LIBRARY)     launchPictureLibrary();
 else     if (mQuickMediaType == Constants.QUICK_POST_VIDEO_CAMERA)     launchVideoCamera();
 else     if (mQuickMediaType == Constants.QUICK_POST_VIDEO_LIBRARY)     launchVideoLibrary();
  }
  return rootView;
}
