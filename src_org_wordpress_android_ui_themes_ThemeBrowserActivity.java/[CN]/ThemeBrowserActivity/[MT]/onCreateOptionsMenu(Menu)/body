{
  MenuInflater inflater=getSupportMenuInflater();
  if (mPreviewFragment != null && !mPreviewFragment.isInLayout() && mPreviewFragment.isVisible()) {
    inflater.inflate(R.menu.theme_preview,menu);
  }
 else   if (mDetailsFragment != null && !mDetailsFragment.isInLayout() && mDetailsFragment.isVisible()) {
    inflater.inflate(R.menu.theme_details,menu);
  }
 else   if (mSearchFragment != null && mSearchFragment.isVisible()) {
    inflater.inflate(R.menu.theme,menu);
    MenuItem searchItem=menu.findItem(R.id.menu_search);
    if (searchItem != null) {
      String lastSearch=mLastSearch;
      onOptionsItemSelected(searchItem);
      mSearchMenuItem.expandActionView();
      onQueryTextChange(lastSearch);
    }
  }
 else {
    inflater.inflate(R.menu.theme,menu);
    refreshMenuItem=menu.findItem(R.id.menu_refresh);
  }
  return super.onCreateOptionsMenu(menu);
}
