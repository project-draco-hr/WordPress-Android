{
  final String galleryOnlyClass="gallery-only-class" + new Random().nextInt(1000);
  @SuppressWarnings("StringBufferReplaceableByString") StringBuilder sbHtml=new StringBuilder("<!DOCTYPE html><html><head><meta charset='UTF-8' />");
  sbHtml.append("<title>Reader Post</title>").append("<meta name='viewport' content='width=device-width, initial-scale=1'>").append("<link href='file:///android_asset/merriweather.css' rel='stylesheet' type='text/css'>").append("<style type='text/css'>").append("  body { font-family: Merriweather, serif; font-weight: 400; margin: 0px; padding: 0px;}").append("  body, p, div { max-width: 100% !important; word-wrap: break-word; }").append("  p, div" + (isWideDisplay ? ":not(." + galleryOnlyClass + ")" : "") + ", li { line-height: 1.6em; font-size: 100%; }").append("  h1, h2 { line-height: 1.2em; }").append("  p, div" + (isWideDisplay ? ":not(." + galleryOnlyClass + ")" : "") + ", dl, table { width: auto !important; height: auto !important; }").append("  body, p, div, a { word-wrap: break-word; }").append("  p { margin-top: ").append(mResourceVars.marginSmallPx).append("px;").append("      margin-bottom: ").append(mResourceVars.marginSmallPx).append("px; }").append("  p:first-child { margin-top: 0px; }").append("  pre { overflow-x: scroll;").append("        background-color: ").append(mResourceVars.greyExtraLightStr).append("; ").append("        padding: ").append(mResourceVars.marginSmallPx).append("px; }").append("  blockquote { margin-left: ").append(mResourceVars.marginSmallPx).append("px; ").append("               padding-left: ").append(mResourceVars.marginSmallPx).append("px; ").append("               border-left: 3px solid ").append(mResourceVars.greyLightStr).append("; }").append("  a { text-decoration: none; color: ").append(mResourceVars.linkColorStr).append("; }").append("  img { max-width: 100%; }").append("  img.size-none { max-width: 100% !important; height: auto !important; }").append("  img.size-full, img.size-large, img.size-medium {").append("     display: block; margin-left: auto; margin-right: auto;").append("     background-color: ").append(mResourceVars.greyExtraLightStr).append(";").append("     margin-bottom: ").append(mResourceVars.marginSmallPx).append("px; }");
  if (isWideDisplay) {
    sbHtml.append(".alignleft {").append("    max-width: 100%;").append("    float: left;").append("    margin-top: 12px;").append("    margin-bottom: 12px;").append("    margin-right: 32px;}").append(".alignright {").append("    max-width: 100%;").append("    float: right;").append("    margin-top: 12px;").append("    margin-bottom: 12px;").append("    margin-left: 32px;}").append(".tiled-gallery {").append("    clear:both;").append("    overflow:hidden;}").append(".tiled-gallery img {").append("    margin:2px !important;}").append(".tiled-gallery .gallery-group {").append("    float:left;").append("    position:relative;}").append(".tiled-gallery .tiled-gallery-item {").append("    float:left;").append("    margin:0;").append("    position:relative;").append("    width:inherit;}").append(".tiled-gallery .gallery-row {").append("    position: relative;").append("    left: 50%;").append("    -webkit-transform: translateX(-50%);").append("    -moz-transform: translateX(-50%);").append("    transform: translateX(-50%);").append("    overflow:hidden;}").append(".tiled-gallery .tiled-gallery-item a {").append("    background:transparent;").append("    border:none;").append("    color:inherit;").append("    margin:0;").append("    padding:0;").append("    text-decoration:none;").append("    width:auto;}").append(".tiled-gallery .tiled-gallery-item img,").append(".tiled-gallery .tiled-gallery-item img:hover {").append("    background:none;").append("    border:none;").append("    box-shadow:none;").append("    max-width:100%;").append("    padding:0;").append("    vertical-align:middle;}").append(".tiled-gallery-caption {").append("    background:#eee;").append("    background:rgba( 255,255,255,0.8 );").append("    color:#333;").append("    font-size:13px;").append("    font-weight:400;").append("    overflow:hidden;").append("    padding:10px 0;").append("    position:absolute;").append("    bottom:0;").append("    text-indent:10px;").append("    text-overflow:ellipsis;").append("    width:100%;").append("    white-space:nowrap;}").append(".tiled-gallery .tiled-gallery-item-small .tiled-gallery-caption {").append("    font-size:11px;}").append(".widget-gallery .tiled-gallery-unresized {").append("    visibility:hidden;").append("    height:0px;").append("    overflow:hidden;}").append(".tiled-gallery .tiled-gallery-item img.grayscale {").append("    position:absolute;").append("    left:0;").append("    top:0;}").append(".tiled-gallery .tiled-gallery-item img.grayscale:hover {").append("    opacity:0;}").append(".tiled-gallery.type-circle .tiled-gallery-item img {").append("    border-radius:50% !important;}").append(".tiled-gallery.type-circle .tiled-gallery-caption {").append("    display:none;").append("    opacity:0;}");
  }
  sbHtml.append("  .wp-caption img { margin-top: 0px; margin-bottom: 0px; }").append("  .wp-caption .wp-caption-text {").append("       font-size: smaller; line-height: 1.2em; margin: 0px;").append("       padding: ").append(mResourceVars.marginExtraSmallPx).append("px; ").append("       color: ").append(mResourceVars.greyMediumDarkStr).append("; }").append("  div#discover { ").append("       margin-top: ").append(mResourceVars.marginSmallPx).append("px;").append("       font-family: sans-serif;").append(" }").append("   iframe { display: block; margin: 0 auto; }").append("  video {").append("     width: ").append(pxToDp(mResourceVars.videoWidthPx)).append("px !important;").append("     height: ").append(pxToDp(mResourceVars.videoHeightPx)).append("px !important; }").append("</style>");
  final List<String> classAmendRegexes=Arrays.asList("(tiled-gallery)([\\s\"\'])","(gallery-row)([\\s\"'])","(gallery-group)([\\s\"'])","(tiled-gallery-item)([\\s\"'])");
  String contentCustomised=content;
  for (  String classToAmend : classAmendRegexes) {
    contentCustomised=contentCustomised.replaceAll(classToAmend,"$1 " + galleryOnlyClass + "$2");
  }
  sbHtml.append("</head><body>").append(contentCustomised).append("</body></html>");
  return sbHtml.toString();
}
