{
  super.onCreate(savedInstanceState);
  ArrayList<String> checkedItems=new ArrayList<String>();
  mFilteredItems=getIntent().getStringArrayListExtra(PARAM_FILTERED_IDS);
  mIsSelectOneItem=getIntent().getBooleanExtra(PARAM_SELECT_ONE_ITEM,false);
  ArrayList<String> prevSelectedItems=getIntent().getStringArrayListExtra(PARAM_SELECTED_IDS);
  if (prevSelectedItems != null)   checkedItems.addAll(prevSelectedItems);
  if (savedInstanceState != null) {
    checkedItems.addAll(savedInstanceState.getStringArrayList(STATE_SELECTED_ITEMS));
    mFilteredItems=savedInstanceState.getStringArrayList(STATE_FILTERED_ITEMS);
    mIsSelectOneItem=savedInstanceState.getBoolean(STATE_IS_SELECT_ONE_ITEM,mIsSelectOneItem);
  }
  setContentView(R.layout.media_gallery_picker_layout);
  mGridView=(MultiSelectGridView)findViewById(R.id.media_gallery_picker_gridview);
  mGridView.setMultiSelectListener(this);
  if (mIsSelectOneItem) {
    mGridView.setOnItemClickListener(this);
    setTitle(R.string.select_from_media_library);
    mGridView.setHighlightSelectModeEnabled(false);
    mGridView.setMultiSelectModeEnabled(false);
    getSupportActionBar().setDisplayHomeAsUpEnabled(true);
  }
 else {
    mActionMode=getSherlock().startActionMode(this);
    mActionMode.setTitle(checkedItems.size() + " selected");
    mGridView.setMultiSelectModeActive(true);
  }
  mGridAdapter=new MediaGridAdapter(this,null,0,checkedItems);
  mGridAdapter.setCallback(this);
  mGridView.setAdapter(mGridAdapter);
}
