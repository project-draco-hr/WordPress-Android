{
  final Dialog dialog=preferenceScreen.getDialog();
  if (!isAdded() || dialog == null) {
    return;
  }
  Toolbar toolbar;
  if (Build.VERSION.SDK_INT >= Build.VERSION_CODES.JELLY_BEAN) {
    if (dialog.findViewById(android.R.id.list) == null) {
      return;
    }
    LinearLayout root=(LinearLayout)dialog.findViewById(android.R.id.list).getParent();
    toolbar=(Toolbar)LayoutInflater.from(getActivity()).inflate(R.layout.toolbar,root,false);
    root.addView(toolbar,0);
  }
 else {
    if (dialog.findViewById(android.R.id.content) == null) {
      return;
    }
    ViewGroup root=(ViewGroup)dialog.findViewById(android.R.id.content);
    if (!(root.getChildAt(0) instanceof ListView)) {
      return;
    }
    ListView content=(ListView)root.getChildAt(0);
    root.removeAllViews();
    toolbar=(Toolbar)LayoutInflater.from(getActivity()).inflate(R.layout.toolbar,root,false);
    int height;
    TypedValue tv=new TypedValue();
    if (getActivity().getTheme().resolveAttribute(R.attr.actionBarSize,tv,true)) {
      height=TypedValue.complexToDimensionPixelSize(tv.data,getResources().getDisplayMetrics());
    }
 else {
      height=toolbar.getHeight();
    }
    content.setPadding(0,height,0,0);
    root.addView(content);
    root.addView(toolbar);
  }
  toolbar.setTitle(preferenceScreen.getTitle());
  toolbar.setNavigationIcon(R.drawable.ic_arrow_back_white_24dp);
  toolbar.setNavigationOnClickListener(new View.OnClickListener(){
    @Override public void onClick(    View v){
      dialog.dismiss();
    }
  }
);
}
