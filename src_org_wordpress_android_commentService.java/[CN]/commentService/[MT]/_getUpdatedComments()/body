{
  WordPressDB settingsDB=new WordPressDB(this);
  Vector<?> notificationAccounts=settingsDB.getNotificationAccounts(this);
  if (notificationAccounts != null) {
    if (notificationAccounts.size() == 0) {
      this.stopSelf();
    }
 else {
      for (int i=0; i < notificationAccounts.size(); i++) {
        accountID=notificationAccounts.get(i).toString();
        accountName=settingsDB.getAccountName(this,accountID);
        Log.i("WordPressCommentService","Checking Comments for " + accountName);
        Vector<?> settings=settingsDB.loadSettings(this,accountID);
        final int latestCommentID=settingsDB.getLatestCommentID(this,accountID);
        String sURL="";
        if (settings.get(0).toString().contains("xmlrpc.php")) {
          sURL=settings.get(0).toString();
        }
 else {
          sURL=settings.get(0).toString() + "xmlrpc.php";
        }
        String sUsername=settings.get(2).toString();
        String sPassword=settings.get(3).toString();
        client=new XMLRPCClient(sURL);
        HashMap<String,Object> hPost=new HashMap<String,Object>();
        hPost.put("status","");
        hPost.put("post_id","");
        hPost.put("number",1);
        Object[] params={1,sUsername,sPassword,hPost};
        XMLRPCMethodCallback callBack=new XMLRPCMethodCallback(){
          @SuppressWarnings("unchecked") public void callFinished(          Object[] result){
            WordPressDB settingsDB=new WordPressDB(commentService.this);
            HashMap<?,?> notificationOptions=settingsDB.getNotificationOptions(commentService.this);
            boolean sound=false, vibrate=false, light=false;
            if (notificationOptions != null) {
              if (notificationOptions.get("sound").toString().equals("1")) {
                sound=true;
              }
              if (notificationOptions.get("vibrate").toString().equals("1")) {
                vibrate=true;
              }
              if (notificationOptions.get("light").toString().equals("1")) {
                light=true;
              }
            }
            if (result.length == 0) {
            }
 else {
              HashMap<Object,Object> contentHash=new HashMap<Object,Object>();
              ;
              for (int ctr=0; ctr < result.length; ctr++) {
                contentHash=(HashMap)result[ctr];
                ctr++;
              }
              String commentID=contentHash.get("comment_id").toString();
              if (latestCommentID == 0) {
                settingsDB.updateLatestCommentID(commentService.this,accountID,Integer.valueOf(commentID));
                Log.i("WordPressCommentService","comment was zero");
              }
 else               if (Integer.valueOf(commentID) > latestCommentID) {
                ApiHelper.refreshComments(accountID,commentService.this);
                final NotificationManager nm=(NotificationManager)getSystemService(NOTIFICATION_SERVICE);
                Intent notificationIntent=new Intent(commentService.this,tabView.class);
                notificationIntent.setData((Uri.parse("custom://wordpressNotificationIntent" + accountID)));
                notificationIntent.putExtra("id",accountID);
                notificationIntent.putExtra("accountName",accountName);
                notificationIntent.putExtra("fromNotification",true);
                PendingIntent pendingIntent=PendingIntent.getActivity(commentService.this,0,notificationIntent,Intent.FLAG_ACTIVITY_CLEAR_TOP);
                String comment=contentHash.get("content").toString();
                String author=contentHash.get("author").toString();
                Notification n=new Notification(R.drawable.wp_logo,author + ": " + comment,System.currentTimeMillis());
                if (sound) {
                  n.defaults|=Notification.DEFAULT_SOUND;
                }
                if (vibrate) {
                  n.defaults|=Notification.DEFAULT_VIBRATE;
                }
                if (light) {
                  n.ledARGB=0xff0000ff;
                  n.ledOnMS=1000;
                  n.ledOffMS=5000;
                  n.flags|=Notification.FLAG_SHOW_LIGHTS;
                }
                n.flags|=Notification.FLAG_AUTO_CANCEL;
                n.setLatestEventInfo(commentService.this,accountName,author + ": " + comment,pendingIntent);
                nm.notify(22 + Integer.valueOf(accountID),n);
                settingsDB.updateLatestCommentID(commentService.this,accountID,Integer.valueOf(commentID));
                Log.i("WordPressCommentService","found a new comment!");
              }
 else {
                Log.i("WordPressCommentService","no new comments");
              }
            }
          }
        }
;
        final Object[] result;
        try {
          result=(Object[])client.call("wp.getComments",params);
          callBack.callFinished(result);
        }
 catch (        XMLRPCException e) {
          e.printStackTrace();
        }
      }
    }
  }
}
