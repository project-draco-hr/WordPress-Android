{
  List<Map<String,Object>> blogs;
  String[] extraFields={"isHidden","dotcomFlag"};
  if (mIsInSearchMode) {
    blogs=WordPress.wpDB.getBlogsBy(null,extraFields);
  }
 else {
    if (mShowHiddenSites) {
      if (mShowSelfHostedSites) {
        blogs=WordPress.wpDB.getBlogsBy(null,extraFields);
      }
 else {
        blogs=WordPress.wpDB.getBlogsBy("dotcomFlag=1",extraFields);
      }
    }
 else {
      if (mShowSelfHostedSites) {
        blogs=WordPress.wpDB.getBlogsBy("dotcomFlag=0 OR (isHidden=0 AND dotcomFlag=1)",extraFields);
      }
 else {
        blogs=WordPress.wpDB.getBlogsBy("isHidden=0 AND dotcomFlag=1",extraFields);
      }
    }
  }
  SiteList sites=new SiteList(blogs);
  Collections.sort(sites,new Comparator<SiteRecord>(){
    public int compare(    SiteRecord site1,    SiteRecord site2){
      return site1.getBlogNameOrHostName().compareToIgnoreCase(site2.getBlogNameOrHostName());
    }
  }
);
  return sites;
}
