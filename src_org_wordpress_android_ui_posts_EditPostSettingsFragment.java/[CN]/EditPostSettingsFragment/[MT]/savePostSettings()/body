{
  Post post=mActivity.getPost();
  if (post == null)   return;
  String password=(mPasswordEditText.getText() != null) ? mPasswordEditText.getText().toString() : "";
  String pubDate=(mPubDateText.getText() != null) ? mPubDateText.getText().toString() : "";
  String excerpt=(mExcerptEditText.getText() != null) ? mExcerptEditText.getText().toString() : "";
  long pubDateTimestamp=0;
  if (mIsCustomPubDate && pubDate.equals(getResources().getText(R.string.immediately)) && !post.isLocalDraft()) {
    Date d=new Date();
    pubDateTimestamp=d.getTime();
  }
 else   if (!pubDate.equals(getResources().getText(R.string.immediately))) {
    if (mIsCustomPubDate)     pubDateTimestamp=mCustomPubDate;
 else     if (post.getDate_created_gmt() > 0)     pubDateTimestamp=post.getDate_created_gmt();
  }
 else   if (pubDate.equals(getResources().getText(R.string.immediately)) && post.isLocalDraft()) {
    post.setDate_created_gmt(0);
    post.setDateCreated(0);
  }
  String tags="", postFormat="";
  if (!post.isPage()) {
    tags=(mTagsEditText.getText() != null) ? mTagsEditText.getText().toString() : "";
    Spinner postFormatSpinner=(Spinner)getActivity().findViewById(R.id.postFormat);
    postFormat=mPostFormats[postFormatSpinner.getSelectedItemPosition()];
  }
  String status=getPostStatusForSpinnerPosition(mStatusSpinner.getSelectedItemPosition());
  if (post.isUploaded() && post.getPostStatus().equals(PostStatus.toString(PostStatus.DRAFT)) && status.equals(PostStatus.toString(PostStatus.PUBLISHED))) {
    post.setChangedFromLocalDraftToPublished(true);
  }
  double latitude=0.0;
  double longitude=0.0;
  if (mCurrentLocation == null) {
    latitude=post.getLatitude();
    longitude=post.getLongitude();
  }
 else   if (WordPress.getCurrentBlog().isLocation() && !mActivity.getPost().isPage()) {
    latitude=mCurrentLocation.getLatitude();
    longitude=mCurrentLocation.getLongitude();
  }
  post.setPostExcerpt(excerpt);
  post.setDate_created_gmt(pubDateTimestamp);
  post.setJSONCategories(new JSONArray(mCategories));
  post.setKeywords(tags);
  post.setPostStatus(status);
  post.setPassword(password);
  post.setLatitude(latitude);
  post.setLongitude(longitude);
  post.setPostFormat(postFormat);
  WordPress.wpDB.updatePost(post);
}
