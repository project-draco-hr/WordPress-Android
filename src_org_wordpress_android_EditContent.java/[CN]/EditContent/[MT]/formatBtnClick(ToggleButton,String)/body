{
  WPEditText contentText=(WPEditText)findViewById(R.id.postContent);
  int selectionStart=contentText.getSelectionStart();
  styleStart=selectionStart;
  int selectionEnd=contentText.getSelectionEnd();
  if (selectionStart > selectionEnd) {
    int temp=selectionEnd;
    selectionEnd=selectionStart;
    selectionStart=temp;
  }
  if (selectionEnd > selectionStart) {
    Spannable str=contentText.getText();
    if (tag.equals("blockquote")) {
      QuoteSpan[] ss=str.getSpans(selectionStart,selectionEnd,QuoteSpan.class);
      boolean exists=false;
      for (int i=0; i < ss.length; i++) {
        str.removeSpan(ss[i]);
        exists=true;
      }
      if (!exists) {
        str.setSpan(new QuoteSpan(),selectionStart,selectionEnd,Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
      }
      toggleButton.setChecked(false);
    }
 else     if (tag.equals("strong")) {
      StyleSpan[] ss=str.getSpans(selectionStart,selectionEnd,StyleSpan.class);
      boolean exists=false;
      for (int i=0; i < ss.length; i++) {
        int style=((StyleSpan)ss[i]).getStyle();
        if (style == android.graphics.Typeface.BOLD) {
          str.removeSpan(ss[i]);
          exists=true;
        }
      }
      if (!exists) {
        str.setSpan(new StyleSpan(android.graphics.Typeface.BOLD),selectionStart,selectionEnd,Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
      }
      toggleButton.setChecked(false);
    }
 else     if (tag.equals("em")) {
      StyleSpan[] ss=str.getSpans(selectionStart,selectionEnd,StyleSpan.class);
      boolean exists=false;
      for (int i=0; i < ss.length; i++) {
        int style=((StyleSpan)ss[i]).getStyle();
        if (style == android.graphics.Typeface.ITALIC) {
          str.removeSpan(ss[i]);
          exists=true;
        }
      }
      if (!exists) {
        str.setSpan(new StyleSpan(android.graphics.Typeface.ITALIC),selectionStart,selectionEnd,Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
      }
      toggleButton.setChecked(false);
    }
 else     if (tag.equals("u")) {
      UnderlineSpan[] ss=str.getSpans(selectionStart,selectionEnd,UnderlineSpan.class);
      boolean exists=false;
      for (int i=0; i < ss.length; i++) {
        str.removeSpan(ss[i]);
        exists=true;
      }
      if (!exists) {
        str.setSpan(new UnderlineSpan(),selectionStart,selectionEnd,Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
      }
      toggleButton.setChecked(false);
    }
 else     if (tag.equals("strike")) {
      StrikethroughSpan[] ss=str.getSpans(selectionStart,selectionEnd,StrikethroughSpan.class);
      boolean exists=false;
      for (int i=0; i < ss.length; i++) {
        str.removeSpan(ss[i]);
        exists=true;
      }
      if (!exists) {
        str.setSpan(new StrikethroughSpan(),selectionStart,selectionEnd,Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
      }
      toggleButton.setChecked(false);
    }
 else     if (tag.equals("ul")) {
      BulletSpan[] ss=str.getSpans(selectionStart,selectionEnd,BulletSpan.class);
      boolean exists=false;
      for (int i=0; i < ss.length; i++) {
        str.removeSpan(ss[i]);
        exists=true;
      }
      if (!exists) {
        str.setSpan(new BulletSpan(),selectionStart,selectionEnd,Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
      }
      toggleButton.setChecked(false);
    }
  }
}
