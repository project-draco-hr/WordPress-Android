{
  URL parsed;
  try {
    parsed=new URL(url.toString());
  }
 catch (  IOException e) {
    throw new HttpRequestException(e);
  }
  String host=parsed.getHost();
  int port=parsed.getPort();
  if (port != -1)   host=host + ':' + Integer.toString(port);
  try {
    return new URI(parsed.getProtocol(),host,parsed.getPath(),parsed.getQuery(),null).toASCIIString();
  }
 catch (  URISyntaxException e) {
    IOException io=new IOException("Parsing URI failed");
    io.initCause(e);
    throw new HttpRequestException(io);
  }
}
