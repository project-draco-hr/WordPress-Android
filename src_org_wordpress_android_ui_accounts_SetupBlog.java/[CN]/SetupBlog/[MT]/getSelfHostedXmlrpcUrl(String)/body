{
  String xmlrpcUrl=null;
  if (!Charset.forName("US-ASCII").newEncoder().canEncode(url)) {
    if (url.toLowerCase().startsWith("http://")) {
      url="http://" + IDN.toASCII(url.substring(7));
    }
 else     if (url.toLowerCase().startsWith("https://")) {
      url="https://" + IDN.toASCII(url.substring(8));
    }
 else {
      url=IDN.toASCII(url);
    }
  }
  if (!(url.toLowerCase().startsWith("http://")) && !(url.toLowerCase().startsWith("https://"))) {
    url="http://" + url;
  }
  if (!URLUtil.isValidUrl(url)) {
    mErrorMsgId=R.string.invalid_url_message;
    return null;
  }
  String rsdUrl=ApiHelper.getRSDMetaTagHrefRegEx(url);
  if (rsdUrl == null) {
    rsdUrl=ApiHelper.getRSDMetaTagHref(url);
  }
  if (rsdUrl != null) {
    xmlrpcUrl=ApiHelper.getXMLRPCUrl(rsdUrl);
    if (xmlrpcUrl == null)     xmlrpcUrl=rsdUrl.replace("?rsd","");
  }
 else {
    try {
      URI nuri=URI.create(url);
      XMLRPCClientInterface client=XMLRPCFactory.instantiate(nuri,mHttpUsername,mHttpPassword);
      try {
        client.call("system.listMethods");
        xmlrpcUrl=url;
        mIsCustomUrl=true;
      }
 catch (      XMLRPCException e) {
        if (e.getMessage().contains("401")) {
          mHttpAuthRequired=true;
          return null;
        }
        String guessURL=url;
        if (guessURL.substring(guessURL.length() - 1,guessURL.length()).equals("/")) {
          guessURL=guessURL.substring(0,guessURL.length() - 1);
        }
        guessURL+="/xmlrpc.php";
        URI guestUri=URI.create(guessURL);
        client=XMLRPCFactory.instantiate(guestUri,mHttpUsername,mHttpPassword);
        try {
          client.call("system.listMethods");
          xmlrpcUrl=guessURL;
        }
 catch (        XMLRPCException ex) {
        }
      }
    }
 catch (    Exception e) {
    }
  }
  return xmlrpcUrl;
}
