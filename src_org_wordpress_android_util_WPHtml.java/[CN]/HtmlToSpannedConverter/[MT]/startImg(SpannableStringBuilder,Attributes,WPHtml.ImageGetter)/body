{
  String src=attributes.getValue("android-uri");
  Bitmap resizedBitmap=null;
  Display display=((WindowManager)ctx.getSystemService(Context.WINDOW_SERVICE)).getDefaultDisplay();
  int width=display.getWidth();
  ImageHelper ih=new ImageHelper();
  HashMap<String,Object> mediaData=ih.getImageBytesForPath(src,ctx);
  if (mediaData != null) {
    byte[] finalBytes=ih.createThumbnail((byte[])mediaData.get("bytes"),String.valueOf(width / 2),(String)mediaData.get("orientation"),true);
    resizedBitmap=BitmapFactory.decodeByteArray(finalBytes,0,finalBytes.length);
    int len=text.length();
    text.append("\uFFFC");
    Uri curStream=Uri.parse(src);
    if (curStream == null) {
      return;
    }
    WPImageSpan is=new WPImageSpan(ctx,resizedBitmap,curStream);
    WordPressDB wpDB=new WordPressDB(ctx);
    MediaFile mf=wpDB.getMediaFile(src,post);
    if (mf != null) {
      is.setTitle(mf.getTitle());
      is.setDescription(mf.getDescription());
      is.setCaption(mf.getCaption());
      is.setFeatured(mf.isFeatured());
      is.setHorizontalAlignment(mf.getHorizontalAlignment());
      is.setImageSource(curStream);
      is.setWidth(mf.getWidth());
      is.setVideo(mf.isVideo());
    }
    text.setSpan(is,len,text.length(),Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
  }
 else {
    if (attributes != null) {
      text.append("<img");
      for (int i=0; i < attributes.getLength(); i++) {
        String aName=attributes.getLocalName(i);
        if ("".equals(aName))         aName=attributes.getQName(i);
        text.append(" ");
        text.append(aName + "=\"" + attributes.getValue(i)+ "\"");
      }
      text.append(" />\n");
    }
  }
}
