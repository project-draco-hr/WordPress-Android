{
  EditText contentText=(EditText)findViewById(R.id.content);
  int selectionStart=contentText.getSelectionStart();
  String startTag="<" + tag + ">";
  String endTag="</" + tag + ">";
  styleStart=selectionStart;
  int selectionEnd=contentText.getSelectionEnd();
  if (selectionStart > selectionEnd) {
    int temp=selectionEnd;
    selectionEnd=selectionStart;
    selectionStart=temp;
  }
  if (localDraft) {
    if (selectionEnd > selectionStart) {
      Spannable str=contentText.getText();
      QuoteSpan[] ss=str.getSpans(selectionStart,selectionEnd,QuoteSpan.class);
      boolean exists=false;
      for (int i=0; i < ss.length; i++) {
        str.removeSpan(ss[i]);
        exists=true;
      }
      if (!exists) {
        str.setSpan(new QuoteSpan(),selectionStart,selectionEnd,Spannable.SPAN_EXCLUSIVE_EXCLUSIVE);
      }
      toggleButton.setChecked(false);
    }
  }
 else {
    String content=contentText.getText().toString();
    if (selectionEnd > selectionStart) {
      contentText.setText(content.substring(0,selectionStart) + startTag + content.substring(selectionStart,selectionEnd)+ endTag+ content.substring(selectionEnd,content.length()));
      toggleButton.setChecked(false);
      contentText.setSelection(selectionStart + content.substring(selectionStart,selectionEnd).length() + startTag.length()+ endTag.length());
    }
 else     if (toggleButton.isChecked()) {
      contentText.setText(content.substring(0,selectionStart) + startTag + content.substring(selectionStart,content.length()));
      contentText.setSelection(selectionEnd + startTag.length());
    }
 else     if (!toggleButton.isChecked()) {
      contentText.setText(content.substring(0,selectionStart) + endTag + content.substring(selectionStart,content.length()));
      contentText.setSelection(selectionEnd + endTag.length());
    }
  }
}
