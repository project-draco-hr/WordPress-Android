{
  EditText titleET=(EditText)findViewById(R.id.title);
  String title=titleET.getText().toString();
  EditText contentET=(EditText)findViewById(R.id.content);
  String content=escapeUtils.unescapeHtml(Html.toHtml(contentET.getText()));
  EditText passwordET=(EditText)findViewById(R.id.post_password);
  String password=passwordET.getText().toString();
  content=content.replace("<p><p>","<p>");
  content=content.replace("</p></p>","</p>");
  content=content.replace("<br><br>","<br>");
  TextView tvPubDate=(TextView)findViewById(R.id.pubDate);
  String pubDate=tvPubDate.getText().toString();
  long pubDateTimestamp=0;
  if (!pubDate.equals(getResources().getText(R.string.immediately))) {
    SimpleDateFormat sdf=new SimpleDateFormat("MMM dd, yyyy hh:mm a");
    Date d=new Date();
    try {
      d=sdf.parse(pubDate);
      pubDateTimestamp=d.getTime();
    }
 catch (    ParseException e) {
      e.printStackTrace();
    }
catch (    java.text.ParseException e) {
      e.printStackTrace();
    }
  }
  String tags="";
  if (!isPage) {
    EditText tagsET=(EditText)findViewById(R.id.tags);
    tags=tagsET.getText().toString();
  }
  String images="";
  boolean success=false;
  if (title.equals("") || (content.equals("") && selectedImageIDs.size() == 0)) {
    AlertDialog.Builder dialogBuilder=new AlertDialog.Builder(editPost.this);
    dialogBuilder.setTitle(getResources().getText(R.string.empty_fields));
    dialogBuilder.setMessage(getResources().getText(R.string.title_post_required));
    dialogBuilder.setPositiveButton("OK",new DialogInterface.OnClickListener(){
      public void onClick(      DialogInterface dialog,      int whichButton){
      }
    }
);
    dialogBuilder.setCancelable(true);
    dialogBuilder.create().show();
  }
 else {
    for (int it=0; it < selectedImageCtr; it++) {
      images+=selectedImageIDs.get(it).toString() + ",";
    }
    Spinner spinner=(Spinner)findViewById(R.id.status);
    int selectedStatus=spinner.getSelectedItemPosition();
    String status="";
switch (selectedStatus) {
case 0:
      status="publish";
    break;
case 1:
  status="draft";
break;
case 2:
status="pending";
break;
case 3:
status="private";
break;
}
Double latitude=0.0;
Double longitude=0.0;
if (blog.isLocation()) {
try {
Location loc=lm.getLastKnownLocation(provider);
latitude=loc.getLatitude();
longitude=loc.getLongitude();
}
 catch (Exception e) {
e.printStackTrace();
}
}
WordPressDB lDraftsDB=new WordPressDB(this);
if (isPage) {
if (isNew) {
success=lDraftsDB.saveLocalPageDraft(this,id,title,content,images,status,password,pubDateTimestamp);
}
 else {
success=lDraftsDB.updateLocalPageDraft(this,id,postID,title,content,images,status,password,pubDateTimestamp);
}
}
 else {
if (isNew) {
success=lDraftsDB.saveLocalDraft(this,id,title,content,images,tags,categories,status,latitude,longitude,password,pubDateTimestamp);
}
 else {
success=lDraftsDB.updateLocalDraft(this,id,postID,title,content,images,tags,categories,status,latitude,longitude,password,pubDateTimestamp);
}
}
}
return success;
}
