{
  EditText titleET=(EditText)findViewById(R.id.title);
  String title=titleET.getText().toString();
  EditText contentET=(EditText)findViewById(R.id.content);
  String content=escapeUtils.unescapeHtml(Html.toHtml(contentET.getText()));
  content=content.replace("<p><p>","<p>");
  content=content.replace("</p></p>","</p>");
  content=content.replace("<br><br>","<br>");
  String tags="";
  if (!isPage) {
    EditText tagsET=(EditText)findViewById(R.id.tags);
    tags=tagsET.getText().toString();
  }
  CheckBox publishCB=(CheckBox)findViewById(R.id.publish);
  boolean publishThis=false;
  String images="";
  boolean success=false;
  Vector<Object> myPostVector=new Vector<Object>();
  String res=null;
  boolean enteredSettings=checkSettings();
  if (!enteredSettings) {
    res="invalidSettings";
  }
 else   if (title.equals("") || (content.equals("") && selectedImageIDs.size() == 0)) {
    AlertDialog.Builder dialogBuilder=new AlertDialog.Builder(editPost.this);
    dialogBuilder.setTitle(getResources().getText(R.string.empty_fields));
    dialogBuilder.setMessage(getResources().getText(R.string.title_post_required));
    dialogBuilder.setPositiveButton("OK",new DialogInterface.OnClickListener(){
      public void onClick(      DialogInterface dialog,      int whichButton){
      }
    }
);
    dialogBuilder.setCancelable(true);
    dialogBuilder.create().show();
  }
 else {
    for (int it=0; it < selectedImageCtr; it++) {
      images+=selectedImageIDs.get(it).toString() + ",";
    }
    if (publishCB.isChecked()) {
      publishThis=true;
    }
    WordPressDB settingsDB=new WordPressDB(this);
    Vector settingsVector=settingsDB.loadSettings(this,id);
    String sLocation=settingsVector.get(11).toString();
    boolean location=false;
    if (sLocation.equals("1")) {
      location=true;
    }
    Double latitude=0.0;
    Double longitude=0.0;
    if (location) {
      try {
        Location loc=lm.getLastKnownLocation(provider);
        latitude=loc.getLatitude();
        longitude=loc.getLongitude();
      }
 catch (      Exception e) {
        e.printStackTrace();
      }
    }
    WordPressDB lDraftsDB=new WordPressDB(this);
    if (isPage) {
      success=lDraftsDB.updateLocalPageDraft(this,id,postID,title,content,images,publishThis);
    }
 else {
      success=lDraftsDB.updateLocalDraft(this,id,postID,title,content,images,tags,categories,publishThis,latitude,longitude);
    }
  }
  return success;
}
