{
  EditText titleET=(EditText)findViewById(R.id.title);
  String title=titleET.getText().toString();
  EditText contentET=(EditText)findViewById(R.id.content);
  String content=contentET.getText().toString();
  CheckBox publishCB=(CheckBox)findViewById(R.id.publish);
  Boolean publishThis=false;
  String imageContent="";
  imageContent=uploadImages();
  String res=null;
  boolean enteredSettings=checkSettings();
  if (!enteredSettings) {
    res="invalidSettings";
  }
 else   if (title.equals("") || (content.equals("") && selectedImageIDs.size() == 0)) {
    res="emptyFields";
  }
 else {
    settingsDB settingsDB=new settingsDB(this);
    Vector categoriesVector=settingsDB.loadSettings(this,id);
    String sURL="";
    if (categoriesVector.get(0).toString().contains("xmlrpc.php")) {
      sURL=categoriesVector.get(0).toString();
    }
 else {
      sURL=categoriesVector.get(0).toString() + "xmlrpc.php";
    }
    String sUsername=categoriesVector.get(2).toString();
    String sPassword=categoriesVector.get(3).toString();
    String sImagePlacement=categoriesVector.get(4).toString();
    String sCenterThumbnailString=categoriesVector.get(5).toString();
    String sFullSizeImageString=categoriesVector.get(6).toString();
    boolean sFullSizeImage=false;
    if (sFullSizeImageString.equals("1")) {
      sFullSizeImage=true;
    }
    boolean centerThumbnail=false;
    if (sCenterThumbnailString.equals("1")) {
      centerThumbnail=true;
    }
    if (publishCB.isChecked()) {
      publishThis=true;
    }
    Map<String,Object> contentStruct=new HashMap<String,Object>();
    if (imageContent != "") {
      if (sImagePlacement.equals("Above Text")) {
        content=imageContent + content;
      }
 else {
        content=content + imageContent;
      }
    }
    contentStruct.put("post_type","post");
    contentStruct.put("title",title);
    contentStruct.put("description",content);
    if (!isPage) {
      EditText tagsET=(EditText)findViewById(R.id.tags);
      String tags=tagsET.getText().toString();
      String[] theCategories=categories.split(",");
      if (tags != "") {
        contentStruct.put("mt_keywords",tags);
      }
      if (theCategories.length > 0) {
        contentStruct.put("categories",theCategories);
      }
    }
    client=new XMLRPCClient(sURL);
    Object[] params={postID,sUsername,sPassword,contentStruct,publishThis};
    Object result=null;
    boolean success=false;
    try {
      result=(Object)client.call("metaWeblog.editPost",params);
      success=true;
    }
 catch (    final XMLRPCException e) {
      Thread prompt=new Thread(){
        public void run(){
          dismissDialog(ID_DIALOG_POSTING);
          AlertDialog.Builder dialogBuilder=new AlertDialog.Builder(editPost.this);
          dialogBuilder.setTitle(getResources().getText(R.string.connection_error));
          dialogBuilder.setMessage(e.getMessage());
          dialogBuilder.setPositiveButton("OK",new DialogInterface.OnClickListener(){
            public void onClick(            DialogInterface dialog,            int whichButton){
            }
          }
);
          dialogBuilder.setCancelable(true);
          dialogBuilder.create().show();
        }
      }
;
      this.runOnUiThread(prompt);
    }
    if (success) {
      newID=result.toString();
      res="OK";
    }
 else {
      res="FAIL";
    }
  }
  return res;
}
