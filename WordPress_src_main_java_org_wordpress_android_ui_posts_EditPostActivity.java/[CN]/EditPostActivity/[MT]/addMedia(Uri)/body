{
  if (imageUri != null && !MediaUtils.isInMediaStore(imageUri) && !imageUri.toString().startsWith("/")) {
    imageUri=MediaUtils.downloadExternalMedia(this,imageUri);
  }
  if (imageUri == null) {
    return false;
  }
  if (mShowNewEditor) {
    String path="";
    if (imageUri.toString().contains("content:")) {
      String[] projection=new String[]{MediaStore.Images.Media.DATA};
      Cursor cur=getContentResolver().query(imageUri,projection,null,null,null);
      if (cur != null && cur.moveToFirst()) {
        int dataColumn=cur.getColumnIndex(MediaStore.Images.Media.DATA);
        path=cur.getString(dataColumn);
        cur.close();
      }
    }
 else {
      path=imageUri.toString().replace("file://","");
    }
    MediaFile mediaFile=queueFileForUpload(path,new ArrayList<String>());
    if (mediaFile != null) {
      mEditorFragment.appendMediaFile(mediaFile,imageUri.toString(),WordPress.imageLoader);
    }
  }
 else {
    String mediaTitle;
    if (MediaUtils.isVideo(imageUri.toString())) {
      mediaTitle=getResources().getString(R.string.video);
    }
 else {
      mediaTitle=ImageUtils.getTitleForWPImageSpan(this,imageUri.getEncodedPath());
    }
    MediaFile mediaFile=new MediaFile();
    mediaFile.setPostID(getPost().getLocalTablePostId());
    mediaFile.setTitle(mediaTitle);
    mediaFile.setFilePath(imageUri.toString());
    if (imageUri.getEncodedPath() != null) {
      mediaFile.setVideo(MediaUtils.isVideo(imageUri.toString()));
    }
    WordPress.wpDB.saveMediaFile(mediaFile);
    mEditorFragment.appendMediaFile(mediaFile,mediaFile.getFilePath(),WordPress.imageLoader);
  }
  return true;
}
