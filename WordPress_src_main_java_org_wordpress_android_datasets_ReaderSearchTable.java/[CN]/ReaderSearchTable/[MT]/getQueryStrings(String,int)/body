{
  String sql;
  String[] args;
  if (TextUtils.isEmpty(filter)) {
    sql="SELECT query_string FROM tbl_search_history ORDER BY date_used DESC";
    args=null;
  }
 else {
    sql="SELECT query_string FROM tbl_search_history WHERE query_string LIKE ? ORDER BY date_used DESC";
    String likeFilter=filter + "%";
    args=new String[]{likeFilter};
  }
  if (max > 0) {
    sql+=" LIMIT " + max;
  }
  Cursor cursor=ReaderDatabase.getReadableDb().rawQuery(sql,args);
  try {
    List<String> queries=new ArrayList<>();
    while (cursor.moveToNext()) {
      queries.add(cursor.getString(0));
    }
    return queries;
  }
  finally {
    SqlUtils.closeCursor(cursor);
  }
}
