{
  ImageView imageView;
  if (convertView == null) {
    imageView=new ImageView(mContext);
    float pixels;
    if (screenDensity > 0) {
      pixels=95 * ((float)screenDensity / (float)160);
    }
 else {
      pixels=85;
    }
    int picSize=(int)pixels;
    imageView.setLayoutParams(new GridView.LayoutParams(picSize,picSize));
    imageView.setScaleType(ImageView.ScaleType.FIT_CENTER);
    Uri tempURI=(Uri)selectedImageIDs.get(position);
    if (!tempURI.toString().contains("video")) {
      String[] projection=new String[]{Images.Thumbnails._ID,Images.Thumbnails.DATA,Images.Media.ORIENTATION};
      String orientation="", path="";
      Cursor cur=managedQuery(tempURI,projection,null,null,null);
      File jpeg=null;
      if (cur != null) {
        String thumbData="";
        if (cur.moveToFirst()) {
          int nameColumn, dataColumn, orientationColumn;
          nameColumn=cur.getColumnIndex(Images.Media._ID);
          dataColumn=cur.getColumnIndex(Images.Media.DATA);
          orientationColumn=cur.getColumnIndex(Images.Media.ORIENTATION);
          thumbData=cur.getString(dataColumn);
          orientation=cur.getString(orientationColumn);
        }
        jpeg=new File(thumbData);
        path=thumbData;
      }
 else {
        path=tempURI.toString().replace("file://","");
        jpeg=new File(tempURI.toString().replace("file://",""));
      }
      imageTitle=jpeg.getName();
      byte[] finalBytes=null;
      byte[] bytes=new byte[(int)jpeg.length()];
      DataInputStream in=null;
      try {
        in=new DataInputStream(new FileInputStream(jpeg));
      }
 catch (      FileNotFoundException e) {
        e.printStackTrace();
      }
      try {
        in.readFully(bytes);
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
      try {
        in.close();
      }
 catch (      IOException e) {
        e.printStackTrace();
      }
      orientation=imageHelper.getExifOrientation(path,orientation);
      imageTitle=jpeg.getName();
      finalBytes=imageHelper.createThumbnail(bytes,"150",orientation,true);
      Bitmap resizedBitmap=BitmapFactory.decodeByteArray(finalBytes,0,finalBytes.length);
      imageView.setImageBitmap(resizedBitmap);
    }
 else {
      imageView.setImageDrawable(getResources().getDrawable(R.drawable.video));
    }
  }
 else {
    imageView=(ImageView)convertView;
  }
  return imageView;
}
