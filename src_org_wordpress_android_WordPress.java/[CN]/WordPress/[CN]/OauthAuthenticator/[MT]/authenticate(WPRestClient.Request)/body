{
  String siteId=request.getSiteId();
  String token=null;
  Blog blog=null;
  SharedPreferences settings=PreferenceManager.getDefaultSharedPreferences(WordPress.this);
  if (siteId == null) {
    token=settings.getString(ACCESS_TOKEN_PREFERENCE,null);
  }
 else {
    blog=wpDB.getBlogForDotComBlogId(siteId);
    if (blog != null) {
      token=blog.getApi_key();
      if (token != null && token.length() < 64 && !blog.isDotcomFlag()) {
        token=null;
      }
      if (token == null && (blog.isDotcomFlag() && blog.getUsername().equals(settings.getString(WPCOM_USERNAME_PREFERENCE,"")))) {
        token=settings.getString(ACCESS_TOKEN_PREFERENCE,null);
      }
    }
  }
  if (token != null) {
    request.sendWithAccessToken(token);
  }
 else {
    requestAccessToken(request,blog);
  }
}
